{"code":"!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"/static/\",i(i.s=54)}({54:function(t,e,i){\"use strict\";i.r(e);var n=i(8),o=i.n(n);i(55),window.GameFrame=o.a,i(56)},55:function(t,e,i){var n=i(7);n.behavior(\"interactive-custom\",(function(t){/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase());if(!document)return{};let e={el:null,moveThrottle:10,minVel:{x:-5,y:-5},maxVel:{x:5,y:5}},i=function(t){let e=function(t){let e=0,i=0;if(t.offsetParent)do{e+=t.offsetLeft,i+=t.offsetTop}while(t=t.offsetParent);return{left:e,top:i}}(t.target),i=t.changedTouches&&t.changedTouches[0]||t,n=i.pageX-e.left,o=i.pageY-e.top;return n*=768/window.innerHeight,o*=768/window.innerHeight,{x:n,y:o}};return{init:function(o){let r,s,a=this;if(t.init.call(this),this.options.defaults(e),this.options(o),this.mousePos=new n.vector,this.mousePosOld=new n.vector,this.offset=new n.vector,this.el=\"string\"==typeof this.options.el?document.getElementById(this.options.el):this.options.el,!this.el)throw\"No DOM element specified\";let l=n.util.throttle((function(t){let e=i(t);a.body&&(s=n.util.ticker.now(),a.mousePosOld.clone(a.mousePos),a.mousePos.set(e.x,e.y),e.body=a.body),a._world.emit(\"interact:move\",e)}),a.options.moveThrottle);this.el.addEventListener(\"mousedown\",(function(t){let e,o=i(t);s=n.util.ticker.now(),a._world&&(e=a._world.findOne({$at:new n.vector(o.x,o.y),$in:a.getTargets()}),e?(r=e.treatment,e.treatment=\"kinematic\",e.state.vel.zero(),e.state.angular.vel=0,a.body=e,a.mousePos.clone(o),a.mousePosOld.clone(o),a.offset.clone(o).vsub(e.state.pos),o.body=e,a._world.emit(\"interact:grab\",o)):\"mousedown\"==t.type&&(e=a._world.findOne({$at:new n.vector(o.x,o.y)}),e&&(o.body=e,a._world.emit(\"interact:poke\",o)),a._world.emit(\"interact:click\",o)))})),this.el.addEventListener(\"mousemove\",l),this.el.addEventListener(\"mouseup\",(function(t){let e=i(t),o=Math.max(n.util.ticker.now()-s,a.options.moveThrottle);a.mousePos.set(e.x,e.y),a.body&&(a.body.treatment=r,a.body.state.vel.clone(a.mousePos).vsub(a.mousePosOld).mult(1/o),a.body.state.vel.clamp(a.options.minVel,a.options.maxVel),a.body=!1),a._world&&a._world.emit(\"interact:release\",e)}))},connect:function(t){t.on(\"integrate:positions\",this.behave,this)},disconnect:function(t){t.off(\"integrate:positions\",this.behave)},behave:function(t){let e,i=this,n=Math.max(t.dt,i.options.moveThrottle);i.body&&(e=i.body.state,e.vel.clone(i.mousePos).vsub(i.offset).vsub(e.pos).mult(1/n))}}}))},56:function(module,exports){var code=\"console.error('Nothing to run!!')\";let image_lookup={};console.log(\"frame.js\"),console.log(window);let meta={debug:!0,external_cache:function(t,e){},cache_proxy:function(t,e){let i=t.split(\"gf://\")[1];return i in image_lookup&&(t=image_lookup[i]),\"https://api.carolinaignites.org/cors/\"+t}};(()=>{let C={__on:{},addEventListener:function(t,e){return this.__on[t]=(this.__on[t]||[]).concat(e),this},dispatchEvent:function(t,e){this.__on[t]=this.__on[t]||[];for(var i=0,n=this.__on[t].length;i<n;i++)this.__on[t][i].call(this,e);return this},log:function(){let t=[];for(let e=0,i=arguments.length;e<i;e++){let i=(new Error).stack.split(\"\\n\")[2].split(\":\"),n=0|i[i.length-2];t.push(arguments[e].toString()+\" (line \"+n+\")\")}this.dispatchEvent(\"log\",t.join(\"\\n\"))},error:function(){let t=[];for(let e=0,i=arguments.length;e<i-2;e++){let i=arguments[e].message;i+=arguments[e].stack.replace(/\\([^:]*:[^:]*:/g,\"(line \"),t.push(i)}this.dispatchEvent(\"error\",t)}};C.debug=C.info=C.log,window.console=C;let query=window.location.search.split(\"?q=\"),lookup=window.location.search.split(\"?l=\");var data={meta:meta};let parse=function(t){let e=window.atob(t),i=document.querySelector(\"#container\");data=JSON.parse(e),meta=Object.assign({},data.meta,meta),code=window.atob(data.code),image_lookup=JSON.parse(window.atob(data.images)),i.innerHTML=window.atob(data.html)};lookup.length>1?$.ajax({url:\"https://api.carolinaignites.org/\"+lookup[1],dataType:\"json\",async:!1,success:t=>{t.valid?parse(t.data):parse(query[1])}}).fail(()=>parse(query[1])):query.length>1&&parse(query[1]),console.log(\"yoyoy;\"),new GameFrame.GameFrame(meta,(function(gf){let collision=gf.collision,gameOver=gf.gameOver,score=gf.score,remove=gf.remove,registerKeys=gf.registerKeys,registerLoops=gf.registerLoops,template=gf.template;try{eval(code)}catch(t){var err=t.constructor(t.message);let e=t.stack.split(\"\\n\")[1].split(\":\");throw err.lineNumber=e[e.length-2],console.error(err),err}}))})()},7:function(t,e,i){var n;n=\"undefined\"!=typeof window?window:this,t.exports=function(){\"use strict\";var t=this,e=t.document,i=function t(){return t.world.apply(t,arguments)};i.util={},(i.aabb=function(t,e,i,n){var o={x:0,y:0,hw:0,hh:0};return void 0===t?o:(t&&void 0!==t.x&&(i=e.x,n=e.y,e=t.y,t=t.x),void 0===n&&void 0!==t&&void 0!==e?(o.hw=.5*t,o.hh=.5*e,i&&void 0!==i.x&&(o.x=i.x,o.y=i.y),o):(o.hw=.5*Math.abs(i-t),o.hh=.5*Math.abs(n-e),o.x=.5*(i+t),o.y=.5*(n+e),o))}).contains=function(t,e){return e.x>t.x-t.hw&&e.x<t.x+t.hw&&e.y>t.y-t.hh&&e.y<t.y+t.hh},i.aabb.clone=function(t){return{x:t.x,y:t.y,hw:t.hw,hh:t.hh}},i.aabb.union=function(t,e,i){var n=!0===i?t:{},o=Math.max(t.x+t.hw,e.x+e.hw),r=Math.max(t.y+t.hh,e.y+e.hh),s=Math.min(t.x-t.hw,e.x-e.hw),a=Math.min(t.y-t.hh,e.y-e.hh);return n.hw=.5*Math.abs(o-s),n.hh=.5*Math.abs(r-a),n.x=.5*(o+s),n.y=.5*(r+a),n},i.aabb.overlap=function(t,e){var i=t.x-t.hw,n=e.x-e.hw,o=t.x+t.hw,r=e.x+e.hw;return(o>=n&&r>=o||r>=i&&o>=r)&&(i=t.y-t.hh,n=e.y-e.hh,o=t.y+t.hh,r=e.y+e.hh,o>=n&&r>=o||r>=i&&o>=r)},function(){var t=function(t,e,i){var n=e.normSq()-e.dot(t),o=e.dot(t)-t.normSq();return 0>n?i.clone(e).negate():o>0?i.clone(t).negate():(i.clone(e).vsub(t),i.perp(t.cross(i)>0))};i.gjk=function(e,n,o,r){var s,a,l,c,h=!1,u=!1,d=!1,p=[],f=1,v=i.scratchpad(),m=v.vector().clone(n||i.vector.axis[0]),g=v.vector(),y=v.vector(),b=v.vector(),_=v.vector(),w=0;for(c=e(m),f=p.push(c),g.clone(c.pt),m.negate();++w;){if(g.swap(y),c=e(m),f=p.push(c),g.clone(c.pt),r&&r(p),g.equals(i.vector.zero)){h=!0;break}if(!u&&g.dot(m)<=0){if(o)break;u=!0}if(2===f)m=t(g,y,m);else if(u){if(m.normalize(),c=y.dot(m),Math.abs(c-g.dot(m))<1e-4){d=-c;break}y.normSq()<b.clone(p[0].pt).normSq()?p.shift():p.splice(1,1),m=t(b.clone(p[1].pt),_.clone(p[0].pt),m)}else if(s=s||v.vector(),a=a||v.vector(),s.clone(y).vsub(g),a.clone(p[0].pt).vsub(g),(l=s.cross(a)>0)^g.cross(s)>0)p.shift(),s.perp(!l),m.swap(s);else{if(!(l^a.cross(g)>0)){h=!0;break}p.splice(1,1),a.perp(l),m.swap(s)}if(w>100)return v.done(),{simplex:p,iterations:w,distance:0,maxIterationsReached:!0}}return v.done(),c={overlap:h,simplex:p,iterations:w},!1!==d&&(c.distance=d,c.closest=function(t){var e,n,o=t.length,r=t[o-2],s=t[o-3],a=i.scratchpad(),l=a.vector().clone(r.pt),c=a.vector().clone(s.pt).vsub(l);return c.equals(i.vector.zero)?a.done({a:r.a,b:r.b}):(n=1-(e=-c.dot(l)/c.normSq()),a.done(0>=n?{a:s.a,b:s.b}:0>=e?{a:r.a,b:r.b}:{a:l.clone(r.a).mult(n).vadd(c.clone(s.a).mult(e)).values(),b:l.clone(r.b).mult(n).vadd(c.clone(s.b).mult(e)).values()}))}(p)),c}}(),i.statistics={pushRunningAvg:function(t,e,i,n){var o=t-i;return[i+=o/e,n+=o*(t-i)]},pushRunningVectorAvg:function(t,e,i,n){var o=1/e,r=t.get(0)-i.get(0),s=t.get(1)-i.get(1);i.add(r*o,s*o),n&&(r*=t.get(0)-i.get(0),s*=t.get(1)-i.get(1),n.add(r,s))}},function(){var t=function t(e,n,o){return this instanceof t?(this.v=new i.vector,this.o=new i.vector,e instanceof t?void this.clone(e):(e&&this.setTranslation(e),void this.setRotation(n||0,o))):new t(e,n)};t.prototype.setTranslation=function(t){return this.v.clone(t),this},t.prototype.setRotation=function(t,e){return this.cosA=Math.cos(t),this.sinA=Math.sin(t),e?this.o.clone(e):this.o.zero(),this},t.prototype.clone=function(e){return e?(this.setTranslation(e.v),this.cosA=e.cosA,this.sinA=e.sinA,this.o.clone(e.o),this):new t(this)},i.transform=t}(),function(t){var e=Math.sqrt,n=Math.min,o=Math.max,r=(Math.acos,Math.atan2),s=2*Math.PI,a=!!t.Float64Array,l=function t(e,i){return this instanceof t?(this._=a?new Float64Array(5):[],void(e&&(void 0!==e.x||e._&&e._.length)?this.clone(e):(this.recalc=!0,this.set(e,i)))):new t(e,i)};Object.defineProperties(l.prototype,{x:{get:function(){return+this._[0]},set:function(t){t=+t||0,this.recalc=t===this._[0],this._[0]=t}},y:{get:function(){return+this._[1]},set:function(t){t=+t||0,this.recalc=t===this._[1],this._[1]=t}}}),l.prototype.set=function(t,e){return this.recalc=!0,this._[0]=+t||0,this._[1]=+e||0,this},l.prototype.get=function(t){return this._[t]},l.prototype.vadd=function(t){return this.recalc=!0,this._[0]+=t._[0],this._[1]+=t._[1],this},l.prototype.vsub=function(t){return this.recalc=!0,this._[0]-=t._[0],this._[1]-=t._[1],this},l.prototype.add=function(t,e){return this.recalc=!0,this._[0]+=+t||0,this._[1]+=+e||0,this},l.prototype.sub=function(t,e){return this.recalc=!0,this._[0]-=t,this._[1]-=void 0===e?0:e,this},l.prototype.mult=function(t){return this.recalc||(this._[4]*=t*t,this._[3]*=t),this._[0]*=t,this._[1]*=t,this},l.prototype.dot=function(t){return this._[0]*t._[0]+this._[1]*t._[1]},l.prototype.cross=function(t){return-this._[0]*t._[1]+this._[1]*t._[0]},l.prototype.proj=function(t){return this.dot(t)/t.norm()},l.prototype.vproj=function(t){var e=this.dot(t)/t.normSq();return this.clone(t).mult(e)},l.prototype.angle=function(t){var e;if(this.equals(l.zero))return t?t.angle():NaN;for(e=t&&!t.equals(l.zero)?r(this._[1]*t._[0]-this._[0]*t._[1],this._[0]*t._[0]+this._[1]*t._[1]):r(this._[1],this._[0]);e>Math.PI;)e-=s;for(;e<-Math.PI;)e+=s;return e},l.prototype.angle2=function(t,e){for(var i=t._[0]-this._[0],n=t._[1]-this._[1],o=e._[0]-this._[0],a=e._[1]-this._[1],l=r(n*o-i*a,i*o+n*a);l>Math.PI;)l-=s;for(;l<-Math.PI;)l+=s;return l},l.prototype.norm=function(){return this.recalc&&(this.recalc=!1,this._[4]=this._[0]*this._[0]+this._[1]*this._[1],this._[3]=e(this._[4])),this._[3]},l.prototype.normSq=function(){return this.recalc&&(this.recalc=!1,this._[4]=this._[0]*this._[0]+this._[1]*this._[1],this._[3]=e(this._[4])),this._[4]},l.prototype.dist=function(t){var i,n;return e((i=t._[0]-this._[0])*i+(n=t._[1]-this._[1])*n)},l.prototype.distSq=function(t){var e,i;return(e=t._[0]-this._[0])*e+(i=t._[1]-this._[1])*i},l.prototype.perp=function(t){var e=this._[0];return t?(this._[0]=this._[1],this._[1]=-e):(this._[0]=-this._[1],this._[1]=e),this},l.prototype.normalize=function(){var t=this.norm();return 0===t||(t=1/t,this._[0]*=t,this._[1]*=t,this._[3]=1,this._[4]=1),this},l.prototype.transform=function(t){var e=t.sinA,i=t.cosA,n=t.o._[0],o=t.o._[1];return this._[0]-=n,this._[1]-=o,this.set(this._[0]*i-this._[1]*e+n+t.v._[0],this._[0]*e+this._[1]*i+o+t.v._[1])},l.prototype.transformInv=function(t){var e=t.sinA,i=t.cosA,n=t.o._[0],o=t.o._[1];return this._[0]-=n+t.v._[0],this._[1]-=o+t.v._[1],this.set(this._[0]*i+this._[1]*e+n,-this._[0]*e+this._[1]*i+o)},l.prototype.rotate=function(t,e){var i,n,o=0,r=0;return\"number\"==typeof t?(i=Math.sin(t),n=Math.cos(t),e&&(o=e.x,r=e.y)):(i=t.sinA,n=t.cosA,o=t.o._[0],r=t.o._[1]),this._[0]-=o,this._[1]-=r,this.set(this._[0]*n-this._[1]*i+o,this._[0]*i+this._[1]*n+r)},l.prototype.rotateInv=function(t){return this.set((this._[0]-t.o._[0])*t.cosA+(this._[1]-t.o._[1])*t.sinA+t.o._[0],-(this._[0]-t.o._[0])*t.sinA+(this._[1]-t.o._[1])*t.cosA+t.o._[1])},l.prototype.translate=function(t){return this.vadd(t.v)},l.prototype.translateInv=function(t){return this.vsub(t.v)},l.prototype.clone=function(t){return t?t._?(this.recalc=t.recalc,t.recalc||(this._[3]=t._[3],this._[4]=t._[4]),this._[0]=t._[0],this._[1]=t._[1],this):this.set(t.x,t.y):new l(this)},l.prototype.swap=function(t){var e=this._;return this._=t._,t._=e,e=this.recalc,this.recalc=t.recalc,t.recalc=e,this},l.prototype.values=function(){return{x:this._[0],y:this._[1]}},l.prototype.zero=function(){return this._[3]=0,this._[4]=0,this._[0]=0,this._[1]=0,this},l.prototype.negate=function(t){return void 0!==t?(this._[t]=-this._[t],this):(this._[0]=-this._[0],this._[1]=-this._[1],this)},l.prototype.clamp=function(t,e){return this._[0]=n(o(this._[0],t.x),e.x),this._[1]=n(o(this._[1],t.y),e.y),this.recalc=!0,this},l.prototype.toString=function(){return\"(\"+this._[0]+\", \"+this._[1]+\")\"},l.prototype.equals=function(t){return this._[0]===t._[0]&&this._[1]===t._[1]&&this._[2]===t._[2]},l.axis=[new l(1,0),new l(0,1)],l.zero=new l(0,0),i.vector=l}(this),function(t){var e=t.Physics;i.noConflict=function(){return t.Physics===i&&(t.Physics=e),i}}(this);var n=i.util.decorator=function(t,e){var n={},o={},r=function(t,e){var n,o;for(o in e)(n=Object.getOwnPropertyDescriptor(e,o)).get||n.set?Object.defineProperty(t,o,n):i.util.isFunction(n.value)&&(t[o]=n.value);return t},s=Object.getPrototypeOf;\"function\"!=typeof s&&(s=\"object\"==typeof\"test\".__proto__?function(t){return t.__proto__}:function(t){return t.constructor.prototype});var a=Object.create;\"function\"!=typeof a&&(a=function(t){function e(){}return e.prototype=t,new e});var l=function(e,n){return\"object\"==typeof e?void((o=r(o,e)).type=t):void(\"type\"!==e&&i.util.isFunction(n)&&(o[e]=n))};l(e);var c=function(e,i,l,c){var h,u=o;if(\"string\"!=typeof i)c=l,l=i;else{if(!(u=n[i]))throw'Error: \"'+i+'\" '+t+\" not defined\";u=u.prototype}if(\"function\"==typeof l)(h=n[e])?h.prototype=r(h.prototype,l(s(h.prototype))):((h=n[e]=function(t){this.init&&this.init(t)}).prototype=a(u),h.prototype=r(h.prototype,l(u,h.prototype))),h.prototype.type=t,h.prototype.name=e;else if(c=l||{},!(h=n[e]))throw'Error: \"'+e+'\" '+t+\" not defined\";return c?new h(c):void 0};return c.mixin=l,c};i.util.indexOf=function(t,e){for(var i=0,n=t.length;n>i;){if(n--,t[i]===e)return i;if(t[n]===e)return n;i++}return-1},i.util.clearArray=function(t){for(var e=t.length;e--;)t.pop();return t},i.util.throttle=function(t,e,i){var n,o,r=!1,s=function(){clearTimeout(n),r?(r=!1,n=setTimeout(s,e),t.apply(i,o)):n=!1};return i=i||null,function(){r=!0,o=arguments,n||s()}};var o=function(t,e){return i.util.isPlainObject(e)?i.util.extend({},t,e,o):void 0!==e?e:t};return i.util.options=function(t,e){var n,r={},s=[];return(n=function(t,n){i.util.extend(e,t,n?o:null);for(var r=0,a=s.length;a>r;++r)s[r](e);return e}).defaults=function(t,n){return i.util.extend(r,t,n?o:null),i.util.defaults(e,r,n?o:null),r},n.onChange=function(t){s.push(t)},e=e||n,n.defaults(t),n},i.util.pairHash=function(t,e){return(0|(t|=0))==(0|(e|=0))?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},i.util.bind=Function.prototype.bind?function(t,e,i){return i=Array.prototype.slice.call(arguments,1),Function.prototype.bind.apply(t,i)}:function(t,e,i){return i=Array.prototype.slice.call(arguments,2),function(){return t.apply(e,i.concat(Array.prototype.slice.call(arguments)))}},i.util.find=function(t,e){var i,n,o=t.length;for(i=0;o>i;i++)if(e(n=t[i],i,t))return n},i.util.filter=function(t,e){var i,n,o=t.length,r=[];for(i=0;o>i;i++)e(n=t[i],i,t)&&r.push(n);return r},function(){function t(t){i.util.clearArray(t),g.length<b&&g.push(t)}function e(){return y.pop()||{array:null,cache:null,criteria:null,false:!1,index:0,null:!1,number:null,object:null,push:null,string:null,true:!1,undefined:!1,value:null}}function n(t,e){var n=typeof e;if(t=t.cache,\"boolean\"===n||null==e)return t[e]?0:-1;\"number\"!==n&&\"string\"!==n&&(n=\"object\");var o=\"number\"===n?e:_+e;return t=(t=t[n])&&t[o],\"object\"===n?t&&i.util.indexOf(t,e)>-1?0:-1:t?0:-1}function o(t){var e=this.cache,i=typeof t;if(\"boolean\"===i||null==t)e[t]=!0;else{\"number\"!==i&&\"string\"!==i&&(i=\"object\");var n=\"number\"===i?t:_+t,o=e[i]||(e[i]={});\"object\"===i?(o[n]||(o[n]=[])).push(t):o[n]=!0}}function r(t){var i=-1,n=t.length,r=t[0],s=t[n/2|0],a=t[n-1];if(r&&\"object\"==typeof r&&s&&\"object\"==typeof s&&a&&\"object\"==typeof a)return!1;var l=e();l.false=l.null=l.true=l.undefined=!1;var c=e();for(c.array=t,c.cache=l,c.push=o;++i<n;)c.push(t[i]);return c}function s(t,e){return t+Math.floor(Math.random()*(e-t+1))}function a(t){return\"function\"==typeof t}function l(t){var e,i;if(!t||f.call(t)!==d||a(e=t.constructor)&&!(e instanceof e))return!1;for(var n in t)i=n;return void 0===i||v.call(t,i)}function c(e,o,s){var a=-1,l=i.util.indexOf,c=e?e.length:0,h=[],u=!o&&c>=m&&l===i.util.indexOf,d=s||u?g.pop()||[]:h;for(u&&(l=n,d=r(d));++a<c;){var p=e[a],f=s?s(p,a,e):p;(o?!a||d[d.length-1]!==f:l(d,f)<0)&&((s||u)&&d.push(f),h.push(p))}return u?(t(d.array),function t(e){var i=e.cache;i&&t(i),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,y.length<b&&y.push(e)}(d)):s&&t(d),h}var h={boolean:!1,function:!0,object:!0,number:!1,string:!1,undefined:!1},u=function(t){return t},d=\"[object Object]\",p=Object.keys,f=Object.prototype.toString,v=Object.prototype.hasOwnProperty,m=75,g=[],y=[],b=40,_=+new Date+\"\",w=p?function(t){return i.util.isObject(t)?p(t):[]}:function(t){var e,i=t,n=[];if(!i)return n;if(!h[typeof t])return n;for(e in i)v.call(i,e)&&n.push(e);return n},x=0;i.util.uniqueId=function(t){return\"\"+(t||\"\")+ ++x},i.util.shuffle=function(t){var e,i,n,o,r=-1,a=t?t.length:0,l=Array(\"number\"==typeof a?a:0);for(e=0,i=t.length;i>e;e++)n=t[e],o=s(0,++r),l[r]=l[o],l[o]=n;return l},i.util.isObject=function(t){return!(!t||!h[typeof t])},i.util.isFunction=a,i.util.isArray=Array.isArray||function(t){return t&&\"object\"==typeof t&&\"number\"==typeof t.length&&\"[object Array]\"===f.call(t)||!1};var P=RegExp(\"^\"+String(f).replace(/[.*+?^${}()|[\\]\\\\]/g,\"\\\\$&\").replace(/toString| for [^\\]]+/g,\".*?\")+\"$\");i.util.isPlainObject=Object.getPrototypeOf?function(t){if(!t||f.call(t)!==d)return!1;var e=t.valueOf,i=function(t){return\"function\"==typeof t&&P.test(t)}(e)&&(i=Object.getPrototypeOf(e))&&Object.getPrototypeOf(i);return i?t===i||Object.getPrototypeOf(t)===i:l(t)}:l,i.util.uniq=function(t,e,i){return\"boolean\"!=typeof e&&null!=e&&(i=e,e=!1),c(t,e,i)},i.util.extend=function(t,e,i){var n,o=t,r=o;if(!o)return r;var s,a=arguments,l=0,c=\"number\"==typeof i?2:a.length;for(c>2&&\"function\"==typeof a[c-1]&&(s=a[--c]);++l<c;)if((o=a[l])&&h[typeof o])for(var u=-1,d=h[typeof o]&&w(o),p=d?d.length:0;++u<p;)r[n=d[u]]=s?s(r[n],o[n]):o[n];return r},i.util.defaults=function(t,e,i){var n,o=t,r=o;if(!o)return r;for(var s=arguments,a=0,l=\"number\"==typeof i?2:s.length;++a<l;)if((o=s[a])&&h[typeof o])for(var c=-1,u=h[typeof o]&&w(o),d=u?u.length:0;++c<d;)void 0===r[n=u[c]]&&(r[n]=o[n]);return r},i.util.sortedIndex=function(t,e,i){var n=0,o=t?t.length:n;for(e=(i=i||u)(e);o>n;){var r=n+o>>>1;i(t[r])<e?n=r+1:o=r}return n}}(),i.scratchpad=function(){var t,e,n=[],o=0,r=0;return(t=function(){if(this._active=!1,this._indexArr=[],++o>=e.maxScratches)throw\"Error: Too many scratchpads created. (Did you forget to call .done()?)\"}).prototype={done:function(t){this._active=!1;for(var e=0;r>e;++e)this[e]=0;return n.push(this),t}},(e=function e(i){if(i)return e.fn(i);var o=n.pop()||new t;return o._active=!0,o}).maxScratches=100,e.maxIndex=20,e.fn=function(e){for(var i=[],o=0,r=e.length;r>o;o++)i.push(o);return i=\"a\"+i.join(\",a\"),new Function(\"fn, scratches, Scratch\",\"return function(\"+i+\"){ var scratch = scratches.pop() || new Scratch( scratches );scratch._active = true;return scratch.done( fn(scratch, \"+i+\") );};\")(e,n,t)},e.register=function(i,n,o){var s=t.prototype,a=r++,l=\"_\"+i+\"Stack\",c=o&&o.useFactory;if(i in s)throw\"Error: Object is already registered.\";t.prototype[i]=function(){var t=this[l]||(this[l]=[]),i=0|this[a];if(this[a]=i+1,!this._active)throw\"Error: Scratchpad used after .done() called. (Could it be unintentionally scoped?)\";if(i>=e.maxIndex)throw\"Error: Scratchpad usage space out of bounds. (Did you forget to call .done()?)\";return t[i]||(t[i]=c?n():new n)}},e.register(\"vector\",i.vector),e.register(\"transform\",i.transform),e}(),function(){function t(t){return t._priority_}i.scratchpad.register(\"event\",(function(){return{}}),{useFactory:!0});var e=function t(){return this instanceof t?void 0:new t};e.prototype={on:function(e,n,o,r){var s,a,l;if(this._topics=this._topics||(this._topics={}),i.util.isObject(e)){for(var c in e)this.on(c,e[c],n,o);return this}return s=this._topics[e]||(this._topics[e]=[]),a=n,i.util.isObject(o)?((n=i.util.bind(n,o))._bindfn_=a,n._one_=a._one_,n._scope_=o):void 0===r&&(r=o),n._priority_=void 0===r?1:r,l=i.util.sortedIndex(s,n,t),s.splice(l,0,n),this},off:function(t,e,n){var o,r;if(!this._topics)return this;if(!0===t)return this._topics={},this;if(i.util.isObject(t)){for(var s in t)this.off(s,t[s]);return this}if(!(o=this._topics[t]))return this;if(!0===e)return this._topics[t]=[],this;for(var a=0,l=o.length;l>a;a++)if(!((r=o[a])._bindfn_!==e&&r!==e||n&&r._scope_!==n)){o.splice(a,1);break}return this},emit:function(t,e){if(!this._topics)return this;var n,o,r=this._topics[t],s=r&&r.length,a=i.scratchpad();if(!s)return a.done(this);for((o=a.event()).topic=t,o.handler=n;s--;)(n=r[s])(e,o),n._one_&&r.splice(s,1);return a.done(this)},one:function(t,e,n){if(i.util.isObject(t)){for(var o in t)this.one(o,t[o],e,n);return this}return e._one_=!0,this.on(t,e,n),this}},i.util.pubsub=e}(),function(t){function e(){return r&&r.now?r.now()+r.timing.navigationStart:Date.now()}var n=!0,o=i.util.pubsub(),r=t.performance;t.requestAnimationFrame?function i(){var r;t.requestAnimationFrame(i),n&&(r=e())&&o.emit(\"tick\",r)}():n=!1,i.util.ticker={now:e,start:function(){return n=!0,this},stop:function(){return n=!1,this},on:function(t){return o.on(\"tick\",t),this},off:function(t){return o.off(\"tick\",t),this},isActive:function(){return!!n}}}(this),function(){var t=function(){return!0},e=i.util.indexOf,n=function(t,e){return function(i){return t(i[e])}},o=function(t,n){return function(o){o=n?o[n]:o;var r,s=0;if(i.util.isArray(o)){if(i.util.isArray(t)){if((r=o.length)!==t.length)return!1;for(;r>s;){if(r--,-1===e(t,o[s])||-1===e(t,o[r]))return!1;s++}return!0}return e(o,t)>-1}return o===t}},r=function(t,n){return function(o){o=n?o[n]:o;var r,s=0;if(i.util.isArray(o)){for(r=o.length;r>s;){if(r--,e(t,o[s])>-1||e(t,o[r])>-1)return!0;s++}return!1}return e(t,o)>-1}},s=function(t){return t.next?function(e){for(var i=t;i;){if(!i(e))return!1;i=i.next}return!0}:t},a={$eq:o,$ne:function(t,e){var i=o(t,e);return function(t){return!i(t)}},$in:r,$nin:function(t,e){var i=r(t,e);return function(t){return!i(t)}},$at:function(t){return t=new i.vector(t),function(e){var n=e.aabb();return i.aabb.contains(n,t)}}};i.query=function e(r,l){var c,h,u,d,p,f;if(l){if(\"$or\"===l||\"$and\"===l){for(c=0,h=r.length;h>c;++c)f=e(r[c]),p=p?p.next=f:d=f;return\"$or\"===l?function(t){return t.next?function(e){for(var i=t;i;){if(i(e))return!0;i=i.next}return!1}:t}(d):s(d)}if(c=a[l])return c(r);throw\"Unknown query operation: \"+l}for(c in r)u=r[c],f=\"$\"===c[0]?e(u,c):i.util.isPlainObject(u)?n(e(u),c):o(u,c),p=p?p.next=f:d=f;return s(d||t)}}(),function(){var t={priority:0};i.behavior=n(\"behavior\",{init:function(e){this.options=i.util.options(t),this.options(e)},applyTo:function(t){return this._targets=!0===t?null:i.util.uniq(t),this},getTargets:function(){return this._targets||(this._world?this._world._bodies:[])},setWorld:function(t){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=t,this.connect&&t&&this.connect(t),this},connect:function(t){this.behave&&t.on(\"integrate:positions\",this.behave,this,this.options.priority)},disconnect:function(t){this.behave&&t.off(\"integrate:positions\",this.behave,this)},behave:null})}(),function(){var t={hidden:!1,treatment:\"dynamic\",mass:1,restitution:1,cof:.8,view:null},e=1;Math.PI,(i.body=n(\"body\",{init:function(n){var o=this,r=i.vector;if(this.options=i.util.options(t,this),this.options.onChange((function(t){o.offset=new r(t.offset)})),this.options(n),this.state={pos:new r(this.x,this.y),vel:new r(this.vx,this.vy),acc:new r,angular:{pos:this.angle||0,vel:this.angularVelocity||0,acc:0},old:{pos:new r,vel:new r,acc:new r,angular:{pos:0,vel:0,acc:0}}},this._sleepAngPosMean=0,this._sleepAngPosVariance=0,this._sleepPosMean=new r,this._sleepPosVariance=new r,this._sleepMeanK=0,delete this.x,delete this.y,delete this.vx,delete this.vy,delete this.angle,delete this.angularVelocity,0===this.mass)throw\"Error: Bodies must have non-zero mass\";this.uid=e++,this.geometry=i.geometry(\"point\")},sleep:function(t){return!0===t?this.asleep=!0:!1===t?(this.asleep=!1,this._sleepMeanK=0,this._sleepAngPosMean=0,this._sleepAngPosVariance=0,this._sleepPosMean.zero(),this._sleepPosVariance.zero(),this.sleepIdleTime=0):t&&!this.asleep&&this.sleepCheck(t),this.asleep},sleepCheck:function(t){var e=this._world&&this._world.options;if(!(this.sleepDisabled||e&&e.sleepDisabled)){var n,o,r,s,a,l,c=i.scratchpad();if(c.vector(),c.vector(),t=t||0,s=this.geometry.aabb(),r=Math.max(s.hw,s.hh),this.asleep&&(o=this.state.vel.norm()+Math.abs(r*this.state.angular.vel))>=(n=this.sleepSpeedLimit||e&&e.sleepSpeedLimit||0))return this.sleep(!1),c.done();this._sleepMeanK++,a=this._sleepMeanK>1?1/(this._sleepMeanK-1):0,i.statistics.pushRunningVectorAvg(this.state.pos,this._sleepMeanK,this._sleepPosMean,this._sleepPosVariance),l=i.statistics.pushRunningAvg(Math.sin(this.state.angular.pos),this._sleepMeanK,this._sleepAngPosMean,this._sleepAngPosVariance),this._sleepAngPosMean=l[0],this._sleepAngPosVariance=l[1],o=this._sleepPosVariance.norm()+Math.abs(r*Math.asin(l[1])),o*=a,(n=this.sleepVarianceLimit||e&&e.sleepVarianceLimit||0)>=o?(n=this.sleepTimeLimit||e&&e.sleepTimeLimit||0,this.sleepIdleTime=(this.sleepIdleTime||0)+t,this.sleepIdleTime>n&&(this.asleep=!0)):this.sleep(!1),c.done()}},setWorld:function(t){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=t,this.connect&&t&&this.connect(t),this},accelerate:function(t){return\"dynamic\"===this.treatment&&this.state.acc.vadd(t),this},applyForce:function(t,e){if(\"dynamic\"!==this.treatment)return this;var n=i.scratchpad(),o=n.vector();return e&&this.moi&&(this.state,o.clone(e),this.state.angular.acc-=o.cross(t)/this.moi),this.accelerate(o.clone(t).mult(1/this.mass)),n.done(),this},getGlobalOffset:function(t){return(t=t||new i.vector).clone(this.offset).rotate(this.state.angular.pos),t},aabb:function(){var t=this.state.angular.pos,e=i.scratchpad(),n=e.vector(),o=this.geometry.aabb(t);return this.getGlobalOffset(n),o.x+=this.state.pos._[0]+n._[0],o.y+=this.state.pos._[1]+n._[1],e.done(o)},toBodyCoords:function(t){return t.vsub(this.state.pos).rotate(-this.state.angular.pos)},toWorldCoords:function(t){return t.rotate(this.state.angular.pos).vadd(this.state.pos)},recalc:function(){return this}})).getCOM=function(t,e){var n,o,r,s=t&&t.length,a=0;if(e=e||new i.vector,!s)return e.zero();if(1===s)return e.clone(t[0].state.pos);for(e.zero(),r=0;s>r;r++)o=(n=t[r]).state.pos,e.add(o._[0]*n.mass,o._[1]*n.mass),a+=n.mass;return e.mult(1/a),e}}(),(i.geometry=n(\"geometry\",{init:function(t){this.options=i.util.options(),this.options(t),this._aabb=new i.aabb},aabb:function(){return i.aabb.clone(this._aabb)},getFarthestHullPoint:function(t,e){return(e=e||new i.vector).set(0,0)},getFarthestCorePoint:function(t,e){return(e=e||new i.vector).set(0,0)}})).regularPolygonVertices=function(t,e){var i,n=[],o=2*Math.PI/t,r=0;for(i=0;t>i;i++)n.push({x:e*Math.cos(r),y:e*Math.sin(r)}),r+=o;return n},i.geometry.isPolygonConvex=function(t){var e=i.scratchpad(),n=e.vector(),o=e.vector(),r=e.vector(),s=!0,a=!1,l=t.length;if(!t||!l)return!1;if(3>l)return e.done(),s;n.clone(t[0]).vsub(r.clone(t[l-1]));for(var c=1;l>=c;++c){if(o.clone(t[c%l]).vsub(r.clone(t[(c-1)%l])),!1===a)a=n.cross(o);else if(a>0^n.cross(o)>0){s=!1;break}o.swap(n)}return e.done(),s},i.geometry.getPolygonMOI=function(t){var e,n=i.scratchpad(),o=n.vector(),r=n.vector(),s=0,a=0,l=t.length;if(2>l)return n.done(),0;if(2===l)return e=r.clone(t[1]).distSq(o.clone(t[0])),n.done(),e/12;o.clone(t[0]);for(var c=1;l>c;++c)r.clone(t[c]),s+=(e=Math.abs(r.cross(o)))*(r.normSq()+r.dot(o)+o.normSq()),a+=e,o.swap(r);return n.done(),s/(6*a)},i.geometry.isPointInPolygon=function(t,e){var n=i.scratchpad(),o=n.vector().clone(t),r=n.vector(),s=n.vector(),a=0,l=e.length;if(2>l)return a=o.equals(r.clone(e[0])),n.done(),a;if(2===l)return a=o.angle(r.clone(e[0])),a+=o.angle(r.clone(e[1])),n.done(),Math.abs(a)===Math.PI;r.clone(e[0]).vsub(o);for(var c=1;l>=c;++c)s.clone(e[c%l]).vsub(o),a+=s.angle(r),r.swap(s);return n.done(),Math.abs(a)>1e-6},i.geometry.getPolygonArea=function(t){var e=i.scratchpad(),n=e.vector(),o=e.vector(),r=0,s=t.length;if(3>s)return e.done(),0;n.clone(t[s-1]);for(var a=0;s>a;++a)o.clone(t[a]),r+=n.cross(o),n.swap(o);return e.done(),r/2},i.geometry.getPolygonCentroid=function(t){var e,n=i.scratchpad(),o=n.vector(),r=n.vector(),s=new i.vector,a=t.length;if(2>a)return n.done(),new i.vector(t[0]);if(2===a)return n.done(),new i.vector((t[1].x+t[0].x)/2,(t[1].y+t[0].y)/2);o.clone(t[a-1]);for(var l=0;a>l;++l)r.clone(t[l]),e=o.cross(r),o.vadd(r).mult(e),s.vadd(o),o.swap(r);return e=1/(6*i.geometry.getPolygonArea(t)),n.done(),s.mult(e)},i.geometry.nearestPointOnLine=function(t,e,n){var o,r,s=i.scratchpad(),a=s.vector().clone(t),l=s.vector().clone(e).vsub(a),c=s.vector().clone(n).vsub(a).vsub(l);return c.equals(i.vector.zero)?(s.done(),new i.vector(e)):0>=(r=1-(o=-c.dot(l)/c.normSq()))?(s.done(),new i.vector(n)):0>=o?(s.done(),new i.vector(e)):(a=new i.vector(n).mult(o).vadd(l.clone(e).mult(r)),s.done(),a)},function(){var t={drag:0};i.integrator=n(\"integrator\",{init:function(e){this.options=i.util.options(t),this.options(e)},setWorld:function(t){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=t,this.connect&&t&&this.connect(t),this},integrate:function(t,e){var i=this._world;return this.integrateVelocities(t,e),i&&i.emit(\"integrate:velocities\",{bodies:t,dt:e}),this.integratePositions(t,e),i&&i.emit(\"integrate:positions\",{bodies:t,dt:e}),this},connect:null,disconnect:null,integrateVelocities:function(){throw\"The integrator.integrateVelocities() method must be overriden\"},integratePositions:function(){throw\"The integrator.integratePositions() method must be overriden\"}})}(),function(){var o={meta:!1,metaRefresh:200,width:600,height:600,autoResize:!0};i.renderer=n(\"renderer\",{init:function(n){var r=this,s=\"string\"==typeof n.el?e.getElementById(n.el):n.el;this.options=i.util.options(o),this.options(n),this.el=s||e.body,this.container=s&&s.parentNode?s.parentNode:e.body,this.drawMeta=i.util.throttle(i.util.bind(this.drawMeta,this),this.options.metaRefresh),t.addEventListener(\"resize\",i.util.throttle((function(){r.options.autoResize&&r.resize()})),100)},resize:function(t,e){void 0===t&&void 0===e&&(t=this.container.offsetWidth,e=this.container.offsetHeight),this.width=t||0,this.height=e||0},setWorld:function(t){return this.disconnect&&this._world&&this.disconnect(this._world),this._world=t,this.connect&&t&&this.connect(t),this},render:function(t,e){var i,n;this.beforeRender&&this.beforeRender(),this._world.emit(\"beforeRender\",{renderer:this,bodies:t,meta:e}),this.options.meta&&this.drawMeta(e),this._interpolateTime=e.interpolateTime;for(var o=0,r=t.length;r>o;++o)n=(i=t[o]).view||(i.view=this.createView(i.geometry,i.styles)),i.hidden||this.drawBody(i,n);return this},createView:function(){throw\"You must override the renderer.createView() method.\"},drawMeta:function(){throw\"You must override the renderer.drawMeta() method.\"},drawBody:function(){throw\"You must override the renderer.drawBody() method.\"}})}(),function(){var t=function t(e,i,n){for(var o,r,s=function(){return t(e,i,n)};o=e.shift();)if((r=o.apply(i,n))&&r.then)return r.then(s)},e={timestep:6,maxIPF:4,webworker:!1,integrator:\"verlet\",sleepDisabled:!1,sleepSpeedLimit:.05,sleepVarianceLimit:.02,sleepTimeLimit:500},n=function t(e,i){return this instanceof t?void this.init(e,i):new t(e,i)};n.prototype=i.util.extend({},i.util.pubsub.prototype,{init:function(n,o){var r=this;(i.util.isFunction(n)||i.util.isArray(n))&&(o=n,n={}),this._meta={fps:0,ipf:0},this._bodies=[],this._behaviors=[],this._integrator=null,this._renderer=null,this._paused=!1,this._warp=1,this._time=0,this.options=i.util.options(e),this.options.onChange((function(t){r.timestep(t.timestep)})),this.options(n),this.add(i.integrator(this.options.integrator)),i.util.isFunction(o)?t([o],this,[this,i]):i.util.isArray(o)&&t(o,this,[this,i])},options:null,add:function(t){var e=0,n=t&&t.length||0,o=i.util.isArray(t)?t[0]:t;if(!o)return this;do{switch(o.type){case\"behavior\":this.addBehavior(o);break;case\"integrator\":this.integrator(o);break;case\"renderer\":this.renderer(o);break;case\"body\":this.addBody(o);break;default:throw'Error: failed to add item of unknown type \"'+o.type+'\" to world'}}while(++e<n&&(o=t[e]));return this},remove:function(t){var e=0,n=t&&t.length||0,o=i.util.isArray(t)?t[0]:t;if(!o)return this;do{switch(o.type){case\"behavior\":this.removeBehavior(o);break;case\"integrator\":o===this._integrator&&this.integrator(null);break;case\"renderer\":o===this._renderer&&this.renderer(null);break;case\"body\":this.removeBody(o);break;default:throw'Error: failed to remove item of unknown type \"'+o.type+'\" from world'}}while(++e<n&&(o=t[e]));return this},has:function(t){var e;if(!t)return!1;switch(t.type){case\"behavior\":e=this._behaviors;break;case\"integrator\":return this._integrator===t;case\"renderer\":return this._renderer===t;case\"body\":e=this._bodies;break;default:throw'Error: unknown type \"'+t.type+'\"'}return i.util.indexOf(e,t)>-1},integrator:function(t){return void 0===t?this._integrator:(this._integrator===t||(this._integrator&&(this._integrator.setWorld(null),this.emit(\"remove:integrator\",{integrator:this._integrator})),t&&(this._integrator=t,this._integrator.setWorld(this),this.emit(\"add:integrator\",{integrator:this._integrator}))),this)},renderer:function(t){return void 0===t?this._renderer:(this._renderer===t||(this._renderer&&(this._renderer.setWorld(null),this.emit(\"remove:renderer\",{renderer:this._renderer})),t&&(this._renderer=t,this._renderer.setWorld(this),this.emit(\"add:renderer\",{renderer:this._renderer}))),this)},timestep:function(t){return t?(this._dt=+t.toPrecision(4),this._maxJump=t*this.options.maxIPF,this):this._dt},wakeUpAll:function(){var t=0,e=this._bodies.length;for(t=0;e>t;t++)this._bodies[t].sleep(!1)},addBehavior:function(t){return this.has(t)||(t.setWorld(this),this._behaviors.push(t),this.emit(\"add:behavior\",{behavior:t})),this},getBehaviors:function(){return[].concat(this._behaviors)},removeBehavior:function(t){var e=this._behaviors;if(t)for(var i=0,n=e.length;n>i;++i)if(t===e[i]){e.splice(i,1),t.setWorld(null),this.emit(\"remove:behavior\",{behavior:t});break}return this},addBody:function(t){return this.has(t)||(t.setWorld(this),this._bodies.push(t),this.emit(\"add:body\",{body:t})),this},getBodies:function(){return[].concat(this._bodies)},removeBody:function(t){var e=this._bodies;if(t)for(var i=0,n=e.length;n>i;++i)if(t===e[i]){e.splice(i,1),t.setWorld(null),this.emit(\"remove:body\",{body:t});break}return this},findOne:function(t){var e=\"function\"==typeof t?t:i.query(t);return i.util.find(this._bodies,e)||!1},find:function(t){var e=\"function\"==typeof t?t:i.query(t);return i.util.filter(this._bodies,e)},iterate:function(t){this._integrator.integrate(this._bodies,t)},step:function(t){var e,n,o,r=this._time,s=this._warp,a=1/s,l=this._dt,c=l*a,h=this._maxJump*a,u=this._meta;if(this._paused||void 0===this._animTime)return this._animTime=t||this._animTime||i.util.ticker.now(),this._paused||this.emit(\"step\",u),this;if((e=(t=t||this._animTime+c)-this._animTime)>h&&(this._animTime=t-h,e=h),o=r+(n=e*s)-l,this.emit(\"beforeStep\"),o>=r)for(;o>=r;)r+=l,this._animTime+=c,this._time=r,this.iterate(l);return u.fps=1e3/(t-this._lastTime),u.ipf=(n/l).toFixed(2),u.interpolateTime=l+o-r,this._lastTime=t,this.emit(\"step\",u),this},warp:function(t){return void 0===t?this._warp:(this._warp=t||1,this)},render:function(){if(!this._renderer)throw\"No renderer added to world\";return this._renderer.render(this._bodies,this._meta),this.emit(\"render\",{bodies:this._bodies,meta:this._meta,renderer:this._renderer}),this},pause:function(){return this._paused=!0,this.emit(\"pause\"),this},unpause:function(){return this._paused=!1,this.emit(\"unpause\"),this},isPaused:function(){return!!this._paused},destroy:function(){var t=this;t.pause(),this.emit(\"destroy\"),t.off(!0),t.remove(t.getBodies()),t.remove(t.getBehaviors()),t.integrator(null),t.renderer(null)}}),i.world=n}(),i.integrator(\"verlet\",(function(t){return i.body.mixin({started:function(t){return void 0!==t&&(this._started=!0),!!this._started}}),{init:function(e){t.init.call(this,e)},integrateVelocities:function(t,e){for(var i,n=e*e,o=1-this.options.drag,r=null,s=.5*(n+e*(this.prevDt||e)),a=0,l=t.length;l>a;++a)i=(r=t[a]).state,\"static\"===r.treatment||r.sleep(e)?(i.vel.zero(),i.acc.zero(),i.angular.vel=0,i.angular.acc=0):(i.vel.equals(i.old.vel)&&r.started()?i.vel.clone(i.pos).vsub(i.old.pos):(i.old.pos.clone(i.pos).vsub(i.vel),i.vel.mult(e)),o&&i.vel.mult(o),i.vel.vadd(i.acc.mult(s)),i.vel.mult(1/e),i.old.vel.clone(i.vel),i.acc.zero(),i.angular.vel===i.old.angular.vel&&r.started()?i.angular.vel=i.angular.pos-i.old.angular.pos:(i.old.angular.pos=i.angular.pos-i.angular.vel,i.angular.vel*=e),i.angular.vel+=i.angular.acc*s,i.angular.vel/=e,i.old.angular.vel=i.angular.vel,i.angular.acc=0,r.started(!0))},integratePositions:function(t,e){for(var i,n=null,o=e/(this.prevDt||e),r=0,s=t.length;s>r;++r)i=(n=t[r]).state,\"static\"===n.treatment||n.sleep()||(i.vel.mult(e*o),i.old.pos.clone(i.pos),i.pos.vadd(i.vel),i.vel.mult(1/(e*o)),i.old.vel.clone(i.vel),i.angular.vel*=e*o,i.old.angular.pos=i.angular.pos,i.angular.pos+=i.angular.vel,i.angular.vel/=e*o,i.old.angular.vel=i.angular.vel);this.prevDt=e}}})),i.geometry(\"point\",(function(){})),i.body(\"point\",(function(t){return{init:function(e){t.init.call(this,e),this.moi=0}}})),i.geometry(\"circle\",(function(t){var e={radius:1};return{init:function(n){t.init.call(this,n),this.options.defaults(e),this.options.onChange((function(t){this.radius=t.radius})),this.options(n),this._aabb=i.aabb(),this.radius=this.options.radius},aabb:function(){var t=this.radius;return this._aabb.hw!==t&&(this._aabb=i.aabb(-t,-t,t,t)),i.aabb.clone(this._aabb)},getFarthestHullPoint:function(t,e){return(e=e||new i.vector).clone(t).normalize().mult(this.radius)},getFarthestCorePoint:function(t,e,n){return(e=e||new i.vector).clone(t).normalize().mult(this.radius-n)}}})),i.geometry(\"compound\",(function(t){var e={};return{init:function(i){t.init.call(this,i),this.options.defaults(e),this.options(i),this.children=[]},addChild:function(t,e,n){return this._aabb=null,this.children.push({g:t,pos:new i.vector(e),angle:n}),this},clear:function(){return this._aabb=null,this.children=[],this},aabb:function(t){if(!t&&this._aabb)return i.aabb.clone(this._aabb);var e,n,o,r=i.scratchpad(),s=i.vector();t=t||0;for(var a=0,l=this.children.length;l>a;a++)e=(n=this.children[a]).g.aabb(t+n.angle),s.clone(n.pos),t&&s.rotate(t),e.x+=s._[0],e.y+=s._[1],o=o?i.aabb.union(o,e,!0):e;return t||(this._aabb=i.aabb.clone(o)),r.done(o)},getFarthestHullPoint:function(t,e){var n,o,r=this.children.length,s=i.scratchpad(),a=s.vector(),l=0,c=0;for(e=e||new i.vector,o=0;r>o;o++)(n=this.children[o]).g.getFarthestHullPoint(t.rotate(-n.angle),a),(l=a.rotate(n.angle).vadd(n.pos).proj(t.rotate(n.angle)))>c&&(c=l,e.swap(a));return s.done(e)},getFarthestCorePoint:function(t,e,n){var o,r,s=this.children.length,a=i.scratchpad(),l=a.vector(),c=0,h=0;for(e=e||new i.vector,r=0;s>r;r++)(o=this.children[r]).g.getFarthestCorePoint(t.rotate(-o.angle),l,n),(c=l.rotate(o.angle).vadd(o.pos).proj(t.rotate(o.angle)))>h&&(h=c,e.swap(l));return a.done(e)}}})),i.geometry(\"convex-polygon\",(function(t){var e={};return{init:function(i){var n=this;t.init.call(this,i),this.options.defaults(e),this.options.onChange((function(t){n.setVertices(t.vertices||[])})),this.options(i),n.setVertices(this.options.vertices||[])},setVertices:function(t){var e=i.scratchpad(),n=e.transform(),o=this.vertices=[];if(!i.geometry.isPolygonConvex(t))throw\"Error: The vertices specified do not match that of a _convex_ polygon.\";n.setRotation(0),n.setTranslation(i.geometry.getPolygonCentroid(t).negate());for(var r=0,s=t.length;s>r;++r)o.push(new i.vector(t[r]).translate(n));return this._area=i.geometry.getPolygonArea(o),this._aabb=!1,e.done(this)},aabb:function(t){if(!t&&this._aabb)return i.aabb.clone(this._aabb);var e,n=i.scratchpad(),o=n.vector(),r=n.transform().setRotation(t||0),s=n.vector().set(1,0).rotateInv(r),a=n.vector().set(0,1).rotateInv(r),l=this.getFarthestHullPoint(s,o).proj(s),c=-this.getFarthestHullPoint(s.negate(),o).proj(s),h=this.getFarthestHullPoint(a,o).proj(a),u=-this.getFarthestHullPoint(a.negate(),o).proj(a);return e=i.aabb(c,u,l,h),t||(this._aabb=i.aabb.clone(e)),n.done(),e},getFarthestHullPoint:function(t,e,n){var o,r,s,a=this.vertices,l=a.length,c=2;if(e=e||new i.vector,2>l)return n&&(n.idx=0),e.clone(a[0]);if(r=a[0].dot(t),o=a[1].dot(t),2===l)return s=o>=r?1:0,n&&(n.idx=s),e.clone(a[s]);if(o>=r){for(;l>c&&o>=r;)r=o,o=a[c].dot(t),c++;return o>=r&&c++,s=c-2,n&&(n.idx=c-2),e.clone(a[s])}for(c=l;c>1&&r>=o;)o=r,r=a[--c].dot(t);return s=(c+1)%l,n&&(n.idx=s),e.clone(a[s])},getFarthestCorePoint:function(t,e,n){var o,r=i.scratchpad(),s=r.vector(),a=r.vector(),l=this.vertices,c=l.length,h=this._area>0,u={};return e=this.getFarthestHullPoint(t,e,u),s.clone(l[(u.idx+1)%c]).vsub(e).normalize().perp(h),a.clone(l[(u.idx-1+c)%c]).vsub(e).normalize().perp(!h),o=n/(1+s.dot(a)),e.vadd(s.vadd(a).mult(o)),r.done(),e}}})),i.geometry(\"rectangle\",(function(t){var e={};return{init:function(i){var n=this;t.init.call(this,i),this.options.defaults(e),this.options.onChange((function(){n.width=n.options.width||1,n.height=n.options.height||1})),this.options(i)},aabb:function(t){if(!t)return i.aabb(this.width,this.height);var e=i.scratchpad(),n=e.vector(),o=e.transform().setRotation(t||0),r=e.vector().set(1,0).rotateInv(o),s=e.vector().set(0,1).rotateInv(o),a=this.getFarthestHullPoint(r,n).proj(r),l=-this.getFarthestHullPoint(r.negate(),n).proj(r),c=this.getFarthestHullPoint(s,n).proj(s),h=-this.getFarthestHullPoint(s.negate(),n).proj(s);return e.done(),i.aabb(l,h,a,c)},getFarthestHullPoint:function(t,e){e=e||new i.vector;var n=t.x,o=t.y;return n=0===n?0:0>n?.5*-this.width:.5*this.width,o=0===o?0:0>o?.5*-this.height:.5*this.height,e.set(n,o)},getFarthestCorePoint:function(t,e,i){var n,o;return n=(e=this.getFarthestHullPoint(t,e)).x,o=e.y,e.x=0===n?0:0>n?n+i:n-i,e.y=0===o?0:0>o?o+i:o-i,e}}})),i.body(\"circle\",(function(t){var e={radius:1};return{init:function(n){t.init.call(this,n),n=i.util.extend({},e,n),this.geometry=i.geometry(\"circle\",{radius:n.radius}),this.recalc()},recalc:function(){t.recalc.call(this),this.moi=this.mass*this.geometry.radius*this.geometry.radius/2}}})),i.body(\"compound\",(function(t){return{init:function(e){t.init.call(this,e),this.mass=0,this.moi=0,this.children=[],this.geometry=i.geometry(\"compound\"),this.addChildren(e.children)},connect:function(){if(this.mass<=0)throw\"Can not add empty compound body to world.\"},addChild:function(t){return this.addChildren([t]),this},addChildren:function(t){var e,n,o,r=this,s=i.scratchpad(),a=s.vector().zero(),l=t&&t.length,c=0;if(!l)return s.done(this);for(o=0;l>o;o++)(e=t[o])._world&&e._world.remove(e),this.children.push(e),this.geometry.addChild(e.geometry,new i.vector(e.offset).rotate(e.state.angular.pos).vadd(e.state.pos),e.state.angular.pos),n=e.state.pos,a.add(n._[0]*e.mass,n._[1]*e.mass),c+=e.mass;return this.mass+=c,a.mult(1/this.mass),this.offset.vsub(a),this._world&&this._world.one(\"render\",(function(){r.view=null})),this.recalc(),s.done(this)},clear:function(){return this._aabb=null,this.moi=0,this.mass=0,this.offset.zero(),this.children=[],this.geometry.clear(),this},refreshGeometry:function(){this.geometry.clear();for(var t,e=0,n=this.children.length;n>e;e++)t=this.children[e],this.geometry.addChild(t.geometry,new i.vector(t.state.pos).vadd(t.offset),t.state.angular.pos);return this},recalc:function(){t.recalc.call(this);for(var e,i=0,n=0,o=this.children.length;o>n;n++)(e=this.children[n]).recalc(),i+=e.moi+e.mass*e.state.pos.normSq();return this.moi=i,this}}})),i.body(\"convex-polygon\",(function(t){var e={};return{init:function(n){t.init.call(this,n),n=i.util.extend({},e,n),this.geometry=i.geometry(\"convex-polygon\",{vertices:n.vertices}),this.recalc()},recalc:function(){t.recalc.call(this),this.moi=i.geometry.getPolygonMOI(this.geometry.vertices)}}})),i.body(\"rectangle\",(function(t){var e={};return{init:function(n){t.init.call(this,n),n=i.util.extend({},e,n),this.geometry=i.geometry(\"rectangle\",{width:n.width,height:n.height}),this.recalc()},recalc:function(){var e=this.geometry.width,i=this.geometry.height;t.recalc.call(this),this.moi=(e*e+i*i)*this.mass/12}}})),i.behavior(\"attractor\",(function(t){var e={pos:null,strength:1,order:2,max:!1,min:!1};return{init:function(n){var o=this;this._pos=new i.vector,t.init.call(this),this.options.defaults(e),this.options.onChange((function(t){o._maxDist=!1===t.max?1/0:t.max,o._minDist=t.min?t.min:10,o.position(t.pos)})),this.options(n)},position:function(t){return t?(this._pos.clone(t),this):this._pos.values()},behave:function(){for(var t,e,n,o=this.getTargets(),r=this.options.order,s=this.options.strength,a=this._minDist,l=this._maxDist,c=i.scratchpad(),h=c.vector(),u=0,d=o.length;d>u;u++)t=o[u],h.clone(this._pos),h.vsub(t.state.pos),(e=h.norm())>a&&l>e&&(n=s/Math.pow(e,r),t.accelerate(h.normalize().mult(n)));c.done()}}})),i.behavior(\"body-collision-detection\",(function(t){var e=[],n=function(t,n){var o=i.util.pairHash(t.uid,n.uid),r=e[o];return r||((r=e[o]=function(e){var i=r.tA,o=r.tB,s=r.tmpv1,a=r.tmpv2;return r.useCore?(s=t.geometry.getFarthestCorePoint(e.rotateInv(i),s,r.marginA),a=n.geometry.getFarthestCorePoint(e.rotate(i).rotateInv(o).negate(),a,r.marginB)):(s=t.geometry.getFarthestHullPoint(e.rotateInv(i),s),a=n.geometry.getFarthestHullPoint(e.rotate(i).rotateInv(o).negate(),a)),s.vadd(t.offset).transform(i),a.vadd(n.offset).transform(o),e.negate().rotate(o),{a:s.values(),b:a.values(),pt:s.vsub(a).values()}}).tA=new i.transform,r.tB=new i.transform,r.tmpv1=new i.vector,r.tmpv2=new i.vector),r.useCore=!1,r.margin=0,r.tA.setRotation(t.state.angular.pos).setTranslation(t.state.pos),r.tB.setRotation(n.state.angular.pos).setTranslation(n.state.pos),r.bodyA=t,r.bodyB=n,r},o=function(t,e){var o,r,s,a,l=i.scratchpad(),c=l.vector(),h=l.vector(),u=l.vector(),d=!1,p=t.aabb(),f=Math.min(p.hw,p.hh),v=e.aabb(),m=Math.min(v.hw,v.hh);if(s=n(t,e),c.clone(t.state.pos).vadd(t.getGlobalOffset(u)).vsub(e.state.pos).vsub(e.getGlobalOffset(u)),(r=i.gjk(s,c,!0)).overlap){for(d={bodyA:t,bodyB:e},a=.01*Math.min(f||1,m||1),s.useCore=!0,s.marginA=0,s.marginB=0;(r.overlap||0===r.distance)&&(s.marginA<f||s.marginB<m);)s.marginA<f&&(s.marginA+=a),s.marginB<m&&(s.marginB+=a),r=i.gjk(s,c);if(r.overlap||r.maxIterationsReached)return l.done(!1);if(0>=(o=s.marginA+s.marginB-r.distance))return l.done(!1);d.overlap=o,d.norm=c.clone(r.closest.b).vsub(h.clone(r.closest.a)).normalize().values(),d.mtv=c.mult(o).values(),d.pos=c.clone(d.norm).mult(s.marginA).vadd(h.clone(r.closest.a)).vsub(t.state.pos).values()}return l.done(d)},r=function t(e,n){if(!(\"static\"!==e.treatment&&\"kinematic\"!==e.treatment||\"static\"!==n.treatment&&\"kinematic\"!==n.treatment))return!1;if(\"circle\"===e.geometry.name&&\"circle\"===n.geometry.name)return function(t,e){var n,o=i.scratchpad(),r=o.vector(),s=o.vector(),a=!1;return r.clone(e.state.pos).vadd(e.getGlobalOffset(s)).vsub(t.state.pos).vsub(t.getGlobalOffset(s)),n=r.norm()-(t.geometry.radius+e.geometry.radius),r.equals(i.vector.zero)&&r.set(1,0),0>=n&&(a={bodyA:t,bodyB:e,norm:r.normalize().values(),mtv:r.mult(-n).values(),pos:r.mult(-t.geometry.radius/n).vadd(s).values(),overlap:-n}),o.done(a)}(e,n);if(\"compound\"===e.geometry.name||\"compound\"===n.geometry.name){var r,s,a,l,c=\"compound\"===e.geometry.name,h=c?e:n,u=c?n:e,d=[],p=i.scratchpad(),f=(p.vector(),p.vector()),v=u.aabb();for(a=0,l=h.children.length;l>a;a++){if(s=h.children[a],f.clone(s.state.pos),s.offset.vadd(f.vadd(h.offset).rotate(-s.state.angular.pos)),s.state.pos.clone(h.state.pos),s.state.angular.pos+=h.state.angular.pos,i.aabb.overlap(v,s.aabb()))if((r=t(u,s))instanceof Array)for(var m,g=0,y=r.length;y>g;g++)(m=r[g]).bodyA===s?m.bodyA=h:m.bodyB=h,d.push(m);else r&&(r.bodyA===s?r.bodyA=h:r.bodyB=h,d.push(r));s.state.angular.pos-=h.state.angular.pos,s.offset.vsub(f),s.state.pos.clone(f.rotate(s.state.angular.pos).vsub(h.offset))}return p.done(d)}return o(e,n)},s={check:\"collisions:candidates\",channel:\"collisions:detected\"};return{init:function(e){t.init.call(this),this.options.defaults(s),this.options(e)},connect:function(t){!0===this.options.check?t.on(\"integrate:velocities\",this.checkAll,this):t.on(this.options.check,this.check,this)},disconnect:function(t){!0===this.options.check?t.off(\"integrate:velocities\",this.checkAll,this):t.off(this.options.check,this.check,this)},check:function(t){for(var e,n,o,s=t.candidates,a=this.getTargets(),l=[],c=this.prevContacts||{},h={},u=i.util.pairHash,d=0,p=s.length;p>d;++d)if(e=s[d],a===this._world._bodies||i.util.indexOf(a,e.bodyA)>-1&&i.util.indexOf(a,e.bodyB)>-1)if((n=r(e.bodyA,e.bodyB))instanceof Array)for(var f,v=0,m=n.length;m>v;v++)(f=n[v])&&(h[o=u(e.bodyA.uid,e.bodyB.uid)]=!0,f.collidedPreviously=c[o],l.push(f));else n&&(h[o=u(e.bodyA.uid,e.bodyB.uid)]=!0,n.collidedPreviously=c[o],l.push(n));this.prevContacts=h,l.length&&this._world.emit(this.options.channel,{collisions:l})},checkAll:function(t){for(var e,n,o,s,a=this.getTargets(),l=(t.dt,[]),c=this.prevContacts||{},h={},u=i.util.pairHash,d=0,p=a.length;p>d;d++){e=a[d];for(var f=d+1;p>f;f++)if(n=a[f],(o=r(e,n))instanceof Array)for(var v,m=0,g=o.length;g>m;m++)(v=o[m])&&(h[s=u(e.uid,n.uid)]=!0,v.collidedPreviously=c[s],l.push(v));else o&&(h[s=u(e.uid,n.uid)]=!0,o.collidedPreviously=c[s],l.push(o))}this.prevContacts=h,l.length&&this._world.emit(this.options.channel,{collisions:l})}}})),i.behavior(\"body-impulse-response\",(function(t){function e(t){return t.uid}function n(t,e,i){var n,o;return n=(o=e.norm())-t.proj(e),n=Math.max(0,Math.min(o,n)),0===o?i.zero():i.clone(e).mult(n/o),i}var o={check:\"collisions:detected\",mtvThreshold:1,bodyExtractDropoff:.5,forceWakeupAboveOverlapThreshold:!0};return{init:function(e){t.init.call(this),this.options.defaults(o),this.options(e),this._bodyList=[]},applyTo:!1,connect:function(t){t.on(this.options.check,this.respond,this)},disconnect:function(t){t.off(this.options.check,this.respond,this)},collideBodies:function(t,e,o,r,s,a){var l=\"static\"===t.treatment||\"kinematic\"===t.treatment,c=\"static\"===e.treatment||\"kinematic\"===e.treatment,h=i.scratchpad(),u=h.vector().clone(s);if(!l||!c){var d,p,f,v=l?0:1/t.moi,m=c?0:1/e.moi,g=l?0:1/t.mass,y=c?0:1/e.mass,b=t.restitution*e.restitution,_=t.cof*e.cof,w=h.vector().clone(o),x=h.vector().clone(w).perp(),P=h.vector(),A=h.vector().clone(r),C=h.vector().clone(r).vadd(t.state.pos).vsub(e.state.pos),k=t.state.angular.vel,T=e.state.angular.vel,I=h.vector().clone(e.state.vel).vadd(P.clone(C).perp().mult(T)).vsub(t.state.vel).vsub(P.clone(A).perp().mult(k)),B=A.proj(w),M=A.proj(x),S=C.proj(w),L=C.proj(x),j=I.proj(w),O=I.proj(x);return a&&(l?(n(e._mtvTotal,u,P),e._mtvTotal.vadd(P)):c?(n(t._mtvTotal,u.negate(),P),t._mtvTotal.vadd(P),u.negate()):(u.mult(.5),n(e._mtvTotal,u,P),e._mtvTotal.vadd(P),u.clone(s).mult(-.5),n(t._mtvTotal,u,P),t._mtvTotal.vadd(P))),j>=0||(d=-(1+b)*j/(g+y+(v=1/0===v?0:v)*M*M+(m=1/0===m?0:m)*L*L),l?(e.state.vel.vadd(w.mult(d*y)),e.state.angular.vel-=d*m*L):c?(t.state.vel.vsub(w.mult(d*g)),t.state.angular.vel+=d*v*M):(e.state.vel.vadd(w.mult(d*y)),e.state.angular.vel-=d*m*L,t.state.vel.vsub(w.mult(g*e.mass)),t.state.angular.vel+=d*v*M),_&&O&&(f=Math.abs(O)/(g+y+v*B*B+m*S*S),p=0>O?-1:1,d=_*Math.abs(d),d=Math.min(d,f),d*=p,l?(e.state.vel.vsub(x.mult(d*y)),e.state.angular.vel-=d*m*S):c?(t.state.vel.vadd(x.mult(d*g)),t.state.angular.vel+=d*v*B):(e.state.vel.vsub(x.mult(d*y)),e.state.angular.vel-=d*m*S,t.state.vel.vadd(x.mult(g*e.mass)),t.state.angular.vel+=d*v*B)),t.sleep()&&t.sleepCheck(),e.sleep()&&e.sleepCheck()),void h.done()}h.done()},_pushUniq:function(t){var n=i.util.sortedIndex(this._bodyList,t,e);this._bodyList[n]!==t&&this._bodyList.splice(n,0,t)},respond:function(t){var e,n,o,r,s=t.collisions;for(n=0,o=s.length;o>n;++n)e=s[n],this._pushUniq(e.bodyA),this._pushUniq(e.bodyB),e.bodyA._mtvTotal=e.bodyA._mtvTotal||new i.vector,e.bodyB._mtvTotal=e.bodyB._mtvTotal||new i.vector,e.bodyA._oldmtvTotal=e.bodyA._oldmtvTotal||new i.vector,e.bodyB._oldmtvTotal=e.bodyB._oldmtvTotal||new i.vector,this.collideBodies(e.bodyA,e.bodyB,e.norm,e.pos,e.mtv,e.collidedPreviously);for(n=0,o=this._bodyList.length;o>n;++n)(r=this._bodyList.pop())._mtvTotal.normSq()<this.options.mtvThreshold?r._mtvTotal.mult(this.options.bodyExtractDropoff):this.options.forceWakeupAboveOverlapThreshold&&r.sleep(!1),r.state.pos.vadd(r._mtvTotal),r.state.old.pos.vadd(r._mtvTotal),r._oldmtvTotal.swap(r._mtvTotal),r._mtvTotal.zero()}}})),i.behavior(\"constant-acceleration\",(function(t){var e={acc:{x:0,y:4e-4}};return{init:function(n){t.init.call(this),this.options.defaults(e),this.options(n),this._acc=new i.vector,this.setAcceleration(this.options.acc),delete this.options.acc},setAcceleration:function(t){return this._acc.clone(t),this},behave:function(){for(var t=this.getTargets(),e=0,i=t.length;i>e;++e)t[e].accelerate(this._acc)}}})),i.behavior(\"edge-collision-detection\",(function(t){var e=function(t,e,n){var o,r=t.aabb(),s=i.scratchpad(),a=t.getGlobalOffset(s.vector()),l=s.transform(),c=s.vector(),h=s.vector(),u=!1,d=[];return(o=r.x+r.hw-e.max.x)>=0&&(c.set(1,0).rotateInv(l.setRotation(t.state.angular.pos)),u={bodyA:t,bodyB:n,overlap:o,norm:{x:1,y:0},mtv:{x:o,y:0},pos:t.geometry.getFarthestHullPoint(c,h).rotate(l).vadd(a).values()},d.push(u)),(o=r.y+r.hh-e.max.y)>=0&&(c.set(0,1).rotateInv(l.setRotation(t.state.angular.pos)),u={bodyA:t,bodyB:n,overlap:o,norm:{x:0,y:1},mtv:{x:0,y:o},pos:t.geometry.getFarthestHullPoint(c,h).rotate(l).vadd(a).values()},d.push(u)),(o=e.min.x-(r.x-r.hw))>=0&&(c.set(-1,0).rotateInv(l.setRotation(t.state.angular.pos)),u={bodyA:t,bodyB:n,overlap:o,norm:{x:-1,y:0},mtv:{x:-o,y:0},pos:t.geometry.getFarthestHullPoint(c,h).rotate(l).vadd(a).values()},d.push(u)),(o=e.min.y-(r.y-r.hh))>=0&&(c.set(0,-1).rotateInv(l.setRotation(t.state.angular.pos)),u={bodyA:t,bodyB:n,overlap:o,norm:{x:0,y:-1},mtv:{x:0,y:-o},pos:t.geometry.getFarthestHullPoint(c,h).rotate(l).vadd(a).values()},d.push(u)),s.done(),d},n=function(t,i,n){return e(t,i,n)},o={aabb:null,restitution:.99,cof:1,channel:\"collisions:detected\"};return{init:function(e){t.init.call(this),this.options.defaults(o),this.options(e),this.setAABB(this.options.aabb),this.restitution=this.options.restitution,this.body=i.body(\"point\",{treatment:\"static\",restitution:this.options.restitution,cof:this.options.cof})},setAABB:function(t){if(!t)throw\"Error: aabb not set\";return this._edges={min:{x:t.x-t.hw,y:t.y-t.hh},max:{x:t.x+t.hw,y:t.y+t.hh}},this},connect:function(t){t.on(\"integrate:positions\",this.checkAll,this,2)},disconnect:function(t){t.off(\"integrate:positions\",this.checkAll,this,2)},checkAll:function(t){for(var e,o,r,s=this.getTargets(),a=(t.dt,[]),l=this._edges,c=this.body,h=this.prevContacts||{},u={},d=i.util.pairHash,p=0,f=s.length;f>p;p++)if(\"dynamic\"===(e=s[p]).treatment&&(o=n(e,l,c))){r=d(e.uid,c.uid);for(var v=0,m=o.length;m>v;v++)u[r]=!0,o[v].collidedPreviously=h[r];a.push.apply(a,o)}this.prevContacts=u,a.length&&this._world.emit(this.options.channel,{collisions:a})}}})),i.behavior(\"interactive\",(function(n){if(!e)return{};var o={el:null,moveThrottle:10,minVel:{x:-5,y:-5},maxVel:{x:5,y:5}},r=function(t){var e=0,i=0;if(t.offsetParent)do{e+=t.offsetLeft,i+=t.offsetTop}while(t=t.offsetParent);return{left:e,top:i}};return{init:function(t){var s=this;if(n.init.call(this),this.options.defaults(o),this.options(t),this.bodyData={},this.bodyDataByUID={},this.el=\"string\"==typeof this.options.el?e.getElementById(this.options.el):this.options.el,!this.el)throw\"No DOM element specified\";s.grab=function(t){var e,n,o,a,l,c,h,u;if(s._world)for(t.changedTouches||(t.changedTouches=[t]),l=r(t.target),h=0,u=t.changedTouches.length;u>h;h++)e={idx:o=(a=t.changedTouches[h]).identifier||a.pointerId||\"mouse\",x:a.pageX-l.left,y:a.pageY-l.top},(n=s._world.findOne({$at:new i.vector(e),$in:s.getTargets()}))?(n.state.vel.zero(),n.state.angular.vel=0,n.isGrabbed=!0,(c=s.bodyData[o]||{}).body=n,n.sleep(!1),c.time=i.util.ticker.now(),c.treatment=s.bodyDataByUID[n.uid]?s.bodyDataByUID[n.uid].treatment:n.treatment,n.treatment=\"kinematic\",c.pos=c.pos||new i.vector,c.pos.clone(e),c.offset=c.offset||new i.vector,c.offset.clone(e).vsub(n.state.pos),c.oldPos=c.oldPos||new i.vector,c.oldPos.clone(e),e.body=n,s.bodyData[o]=c,s.bodyDataByUID[n.uid]=c,s._world.emit(\"interact:grab\",e)):s._world.emit(\"interact:poke\",e)},s.move=i.util.throttle((function(t){var e,n,o,a,l,c,h,u;if(s._world)for(t.changedTouches||(t.changedTouches=[t]),l=r(s.el),h=0,u=t.changedTouches.length;u>h;h++)e={idx:o=(a=t.changedTouches[h]).identifier||a.pointerId||\"mouse\",x:a.pageX-l.left,y:a.pageY-l.top},(c=s.bodyData[o])&&((n=c.body).sleep(!1),c.time=i.util.ticker.now(),c.oldPos.clone(c.pos),c.pos.clone(e),e.body=n),s._world.emit(\"interact:move\",e)}),s.options.moveThrottle),s.release=function(t){var e,n,o,a,l,c,h,u,d;if(s._world)for(t.changedTouches||(t.changedTouches=[t]),u=0,d=t.changedTouches.length;d>u;u++)l=r(s.el),e={idx:o=(a=t.changedTouches[u]).identifier||a.pointerId||\"mouse\",x:a.pageX-l.left,y:a.pageY-l.top},(c=s.bodyData[o])&&((n=c.body).sleep(!1),c.pos.clone(e),h=Math.max(i.util.ticker.now()-c.time,s.options.moveThrottle),n.treatment=c.treatment,n.state.vel.clone(c.pos).vsub(c.oldPos).mult(1/h),n.state.vel.clamp(s.options.minVel,s.options.maxVel),n.isGrabbed=!1,e.body=n,delete n.isGrabbed),s._world.emit(\"interact:release\",e),delete s.bodyData[o]}},connect:function(e){e.on(\"integrate:positions\",this.behave,this),t.PointerEvent?(this.el.addEventListener(\"pointerdown\",this.grab),t.addEventListener(\"pointermove\",this.move),t.addEventListener(\"pointerup\",this.release)):(this.el.addEventListener(\"mousedown\",this.grab),this.el.addEventListener(\"touchstart\",this.grab),t.addEventListener(\"mousemove\",this.move),t.addEventListener(\"touchmove\",this.move),t.addEventListener(\"mouseup\",this.release),t.addEventListener(\"touchend\",this.release))},disconnect:function(e){e.off(\"integrate:positions\",this.behave,this),t.PointerEvent?(this.el.removeEventListener(\"pointerdown\",this.grab),t.removeEventListener(\"pointermove\",this.move),t.removeEventListener(\"pointerup\",this.release)):(this.el.removeEventListener(\"mousedown\",this.grab),this.el.removeEventListener(\"touchstart\",this.grab),t.removeEventListener(\"mousemove\",this.move),t.removeEventListener(\"touchmove\",this.move),t.removeEventListener(\"mouseup\",this.release),t.removeEventListener(\"touchend\",this.release))},behave:function(t){var e,i,n=this,o=Math.max(t.dt,n.options.moveThrottle);for(var r in n.bodyData)(e=(i=n.bodyData[r]).body.state).vel.clone(i.pos).vsub(i.offset).vsub(e.pos).mult(1/o)}}})),i.behavior(\"newtonian\",(function(t){var e={strength:1,max:!1,min:!1};return{init:function(i){var n=this;t.init.call(this),this.options.defaults(e),this.options.onChange((function(t){n._maxDistSq=!1===t.max?1/0:t.max*t.max,n._minDistSq=t.min?t.min*t.min:100*t.strength})),this.options(i)},calcPotential:function(t,e,n){var o,r,s,a=this.options.strength,l=this._minDistSq,c=this._maxDistSq;return(s=n||new i.vector).clone(e).vsub(t),(o=s.normSq())>l&&c>o?(r=a/o,s.normalize().mult(r)):s.zero()},behave:function(){var t,e,n,o,r,s,a,l,c,h,u,d,p=this.getTargets(),f=i.scratchpad(),v=f.vector(),m=f.vector(),g=f.vector();for(a=0,h=p.length;h>a;a++)for(t=p[a],s=a+1;h>s;s++){if(e=p[s],\"compound\"===t.name?n=t:\"compound\"===e.name&&(n=e,e=t),n)if(\"compound\"===e.name)for(l=0,u=n.children.length;u>l;l++)for(o=n.children[l],n.toWorldCoords(m.clone(o.state.pos).vadd(n.offset)),c=0,d=e.children.length;d>c;c++)r=e.children[c],e.toWorldCoords(g.clone(r.state.pos).vadd(e.offset)),this.calcPotential(m,g,v),n.accelerate(v.mult(r.mass)),e.accelerate(v.mult(o.mass/r.mass).negate());else for(l=0,u=n.children.length;u>l;l++)o=n.children[l],n.toWorldCoords(m.clone(o.state.pos).vadd(n.offset)),this.calcPotential(m,e.state.pos,v),n.accelerate(v.mult(e.mass)),e.accelerate(v.mult(o.mass/e.mass).negate());else this.calcPotential(t.state.pos,e.state.pos,v),t.accelerate(v.mult(e.mass)),e.accelerate(v.mult(t.mass/e.mass).negate());n=null}f.done()}}})),i.behavior(\"sweep-prune\",(function(t){var e=1,n=function(){return e++},o={x:0,y:1},r=i.util.pairHash;return{init:function(e){t.init.call(this),this.options.defaults({channel:\"collisions:candidates\"}),this.options(e),this.encounters=[],this.candidates=[],this.clear()},clear:function(){this.tracked=[],this.pairs=[],this.intervalLists=[];for(var t=0;2>t;++t)this.intervalLists[t]=[]},connect:function(t){t.on(\"add:body\",this.trackBody,this),t.on(\"remove:body\",this.untrackBody,this),t.on(\"integrate:positions\",this.sweep,this,1);for(var e=t.getBodies(),i=0,n=e.length;n>i;++i)this.trackBody({body:e[i]})},disconnect:function(t){t.off(\"add:body\",this.trackBody,this),t.off(\"remove:body\",this.untrackBody,this),t.off(\"integrate:positions\",this.sweep,this,1),this.clear()},broadPhase:function(){return this.updateIntervals(),this.sortIntervalLists(),this._world&&this._world.emit(\"sweep-prune:intervals\",this.intervalLists),this.checkOverlaps()},sortIntervalLists:function(){for(var t,e,i,n,o,r,s,a,l,c=0;2>c;++c)for(i=0,e=(t=this.intervalLists[c]).length,l=c;++i<e;){for(r=(o=t[i]).val.get(l),a=(s=t[(n=i)-1])&&s.val.get(l);n>0&&(a>r||a===r&&s.type&&!o.type);)t[n]=s,a=(s=t[--n-1])&&s.val.get(l);t[n]=o}},getPair:function(t,e,i){var n=r(t.id,e.id);if(!1===n)return null;var o=this.pairs[n];if(!o){if(!i)return null;o=this.pairs[n]={bodyA:t.body,bodyB:e.body,flag:1}}return i&&(o.flag=1),o},checkOverlaps:function(){var t,e,n,r,s,a,l,c,h,u=1<<o.z+1<<o.y+1<<o.x+1,d=this.encounters,p=0,f=this.candidates;i.util.clearArray(d),i.util.clearArray(f);for(var v=0;2>v;++v)for(t=0===v,l=0,a=(s=this.intervalLists[v]).length;a>l;l++)if(e=(r=s[l]).tracker,r.type)for(c=p,c=p-1;c>=0;c--)(n=d[c])===e?(p-1>c?d[c]=d.pop():d.pop(),p--):(h=this.getPair(e,n,t))&&h.flag<u&&(h.flag=h.flag<<v+1,h.flag===u&&f.push(h));else p=d.push(e);return f},updateIntervals:function(){for(var t,e,i,n=this.tracked,o=n.length;--o>=0;)e=(t=n[o]).interval,i=t.body.aabb(),e.min.val.clone(i).sub(i.hw,i.hh),e.max.val.clone(i).add(i.hw,i.hh)},trackBody:function(t){var e=t.body,o={id:n(),body:e},r={min:{type:!1,val:new i.vector,tracker:o},max:{type:!0,val:new i.vector,tracker:o}};o.interval=r,this.tracked.push(o);for(var s=0;2>s;++s)this.intervalLists[s].push(r.min,r.max)},untrackBody:function(t){for(var e,i,n,o,r=t.body,s=this.tracked,a=0,l=s.length;l>a;++a)if((n=s[a]).body===r){s.splice(a,1);for(var c=0;2>c;++c){o=0;for(var h=0,u=(e=this.intervalLists[c]).length;u>h;++h)if((i=e[h])===n.interval.min||i===n.interval.max){if(e.splice(h,1),h--,l--,o>0)break;o++}}break}},sweep:function(){var t;(t=this.broadPhase()).length&&this._world.emit(this.options.channel,{candidates:t})}}})),i.behavior(\"verlet-constraints\",(function(t){var e=2*Math.PI,n={iterations:2};return{init:function(e){t.init.call(this),this.options.defaults(n),this.options(e),this._distanceConstraints=[],this._angleConstraints=[]},connect:function(t){var e=t.integrator();if(e&&e.name.indexOf(\"verlet\")<0)throw'The rigid constraint manager needs a world with a \"verlet\" compatible integrator.';t.on(\"integrate:positions\",this.resolve,this)},disconnect:function(t){t.off(\"integrate:positions\",this.resolve,this)},drop:function(){return this._distanceConstraints=[],this._angleConstraints=[],this},distanceConstraint:function(t,e,n,o){var r;return!(!t||!e)&&((r={id:i.util.uniqueId(\"dis-constraint\"),type:\"dis\",bodyA:t,bodyB:e,stiffness:n||.5,targetLength:o||e.state.pos.dist(t.state.pos)}).targetLengthSq=r.targetLength*r.targetLength,this._distanceConstraints.push(r),r)},angleConstraint:function(t,e,n,o,r){var s;return!(!t||!e)&&(s={id:i.util.uniqueId(\"ang-constraint\"),type:\"ang\",bodyA:t,bodyB:e,bodyC:n,stiffness:o||.5,targetAngle:r||e.state.pos.angle2(t.state.pos,n.state.pos)},this._angleConstraints.push(s),s)},remove:function(t){var e,n,o,r;if(e=\"ang\"===((n=i.util.isObject(t))?t.type:t.substr(0,3))?this._angleConstraints:this._distanceConstraints,n){for(o=0,r=e.length;r>o;++o)if(e[o]===t)return e.splice(o,1),this}else for(o=0,r=e.length;r>o;++o)if(e[o].id===t)return e.splice(o,1),this;return this},resolveAngleConstraints:function(t){for(var n,o,r,s,a=this._angleConstraints,l=i.scratchpad(),c=l.transform(),h=0,u=a.length;u>h;++h)(r=(o=(n=a[h]).bodyB.state.pos.angle2(n.bodyA.state.pos,n.bodyC.state.pos))-n.targetAngle)&&(r<=-Math.PI?r+=e:r>=Math.PI&&(r-=e),c.setTranslation(n.bodyB.state.pos),r*=-t*n.stiffness,\"dynamic\"===n.bodyA.treatment&&\"dynamic\"===n.bodyB.treatment&&\"dynamic\"===n.bodyC.treatment&&(s=1/(n.bodyA.mass+n.bodyB.mass+n.bodyC.mass)),\"dynamic\"===n.bodyA.treatment&&(o=\"dynamic\"===n.bodyB.treatment&&\"dynamic\"===n.bodyC.treatment?r*(n.bodyB.mass+n.bodyC.mass)*s:\"dynamic\"!==n.bodyB.treatment?r*n.bodyC.mass/(n.bodyC.mass+n.bodyA.mass):r*n.bodyB.mass/(n.bodyB.mass+n.bodyA.mass),c.setRotation(o),n.bodyA.state.pos.translateInv(c),n.bodyA.state.pos.rotate(c),n.bodyA.state.pos.translate(c)),\"dynamic\"===n.bodyC.treatment&&(o=\"dynamic\"===n.bodyA.treatment&&\"dynamic\"===n.bodyB.treatment?-r*(n.bodyB.mass+n.bodyA.mass)*s:\"dynamic\"!==n.bodyB.treatment?-r*n.bodyA.mass/(n.bodyC.mass+n.bodyA.mass):-r*n.bodyB.mass/(n.bodyB.mass+n.bodyC.mass),c.setRotation(o),n.bodyC.state.pos.translateInv(c),n.bodyC.state.pos.rotate(c),n.bodyC.state.pos.translate(c)),\"dynamic\"===n.bodyB.treatment&&(o=\"dynamic\"===n.bodyA.treatment&&\"dynamic\"===n.bodyC.treatment?r*(n.bodyA.mass+n.bodyC.mass)*s:\"dynamic\"!==n.bodyA.treatment?r*n.bodyC.mass/(n.bodyC.mass+n.bodyB.mass):r*n.bodyA.mass/(n.bodyA.mass+n.bodyC.mass),c.setRotation(o).setTranslation(n.bodyA.state.pos),n.bodyB.state.pos.translateInv(c),n.bodyB.state.pos.rotate(c),n.bodyB.state.pos.translate(c),c.setTranslation(n.bodyC.state.pos),n.bodyB.state.pos.translateInv(c),n.bodyB.state.pos.rotateInv(c),n.bodyB.state.pos.translate(c)),n.bodyA.sleepCheck(),n.bodyB.sleepCheck(),n.bodyC.sleepCheck());l.done()},resolveDistanceConstraints:function(t){for(var e,n,o,r,s=this._distanceConstraints,a=i.scratchpad(),l=a.vector(),c=0,h=s.length;h>c;++c)e=s[c],l.clone(e.bodyB.state.pos).vsub(e.bodyA.state.pos),n=l.normSq()||1e-4*Math.random(),o=t*e.stiffness*(n-e.targetLengthSq)/n,l.mult(o),r=\"dynamic\"!==e.bodyA.treatment||\"dynamic\"!==e.bodyB.treatment?1:e.bodyB.mass/(e.bodyA.mass+e.bodyB.mass),\"dynamic\"===e.bodyA.treatment&&(\"dynamic\"===e.bodyB.treatment&&l.mult(r),e.bodyA.state.pos.vadd(l),\"dynamic\"===e.bodyB.treatment&&l.mult(1/r)),\"dynamic\"===e.bodyB.treatment&&(\"dynamic\"===e.bodyA.treatment&&l.mult(1-r),e.bodyB.state.pos.vsub(l)),e.bodyA.sleepCheck(),e.bodyB.sleepCheck();a.done()},shuffleConstraints:function(){this._distanceConstraints=i.util.shuffle(this._distanceConstraints),this._angleConstraints=i.util.shuffle(this._angleConstraints)},resolve:function(){for(var t=this.options.iterations,e=1/t,i=0;t>i;i++)this.resolveDistanceConstraints(e),this.resolveAngleConstraints(e)},getConstraints:function(){return{distanceConstraints:[].concat(this._distanceConstraints),angleConstraints:[].concat(this._angleConstraints)}}}})),i.integrator(\"improved-euler\",(function(t){return{init:function(e){t.init.call(this,e)},integrateVelocities:function(t,e){for(var i,n=1-this.options.drag,o=null,r=0,s=t.length;s>r;++r)i=(o=t[r]).state,\"static\"===o.treatment||o.sleep(e)?(i.vel.zero(),i.acc.zero(),i.angular.vel=0,i.angular.acc=0):(i.old.vel.clone(i.vel),i.old.acc.clone(i.acc),i.vel.vadd(i.acc.mult(e)),n&&i.vel.mult(n),i.acc.zero(),i.old.angular.vel=i.angular.vel,i.angular.vel+=i.angular.acc*e,i.angular.acc=0)},integratePositions:function(t,e){for(var n,o=.5*e*e,r=null,s=i.scratchpad(),a=s.vector(),l=0,c=t.length;c>l;++l)n=(r=t[l]).state,\"static\"===r.treatment||r.sleep()||(n.old.pos.clone(n.pos),a.clone(n.old.vel),n.pos.vadd(a.mult(e)).vadd(n.old.acc.mult(o)),n.old.acc.zero(),n.old.angular.pos=n.angular.pos,n.angular.pos+=n.old.angular.vel*e+n.old.angular.acc*o,n.old.angular.acc=0);s.done()}}})),i.integrator(\"velocity-verlet-alt\",(function(t){return i.body.mixin({started:function(t){return void 0!==t&&(this._started=!0),!!this._started}}),{init:function(e){t.init.call(this,e)},integrateVelocities:function(t,e){for(var i,n=1-this.options.drag,o=null,r=0,s=t.length;s>r;++r)i=(o=t[r]).state,\"static\"!==o.treatment?(o.started()||(i.old.acc.clone(i.acc),i.old.acc.mult(e),i.old.vel.clone(i.vel).vsub(i.old.acc),i.old.acc.mult(1/e)),n&&i.vel.mult(n),i.vel.vadd(i.old.acc.vadd(i.acc).mult(.5*e)),o.started()||(i.old.angular.acc=i.angular.acc,i.old.angular.vel=i.angular.vel-i.old.angular.acc*e),i.angular.vel+=.5*(i.angular.acc+i.old.angular.acc)*e,i.angular.acc=0,o.started(!0)):(i.vel.zero(),i.acc.zero(),i.angular.vel=0,i.angular.acc=0)},integratePositions:function(t,e){for(var i,n=e*e,o=null,r=0,s=t.length;s>r;++r)i=(o=t[r]).state,\"static\"!==o.treatment&&(i.old.pos.clone(i.pos),i.old.vel.mult(e),i.old.acc.mult(.5*n),i.pos.vadd(i.old.vel).vadd(i.old.acc),i.old.vel.clone(i.vel),i.old.acc.clone(i.acc),i.acc.zero(),i.old.angular.pos=i.angular.pos,i.angular.pos+=i.angular.vel*e+.5*i.old.angular.acc*n,i.old.angular.vel=i.angular.vel,i.old.angular.acc=i.angular.acc,i.angular.acc=0)}}})),i.integrator(\"velocity-verlet\",(function(t){return i.body.mixin({started:function(t){return void 0!==t&&(this._started=!0),!!this._started}}),{init:function(e){t.init.call(this,e)},integrate:function(t,e){var i=this._world;return this.integratePositions(t,e),i&&i.emit(\"integrate:positions\",{bodies:t,dt:e}),this.integrateVelocities(t,e),i&&i.emit(\"integrate:velocities\",{bodies:t,dt:e}),this},integrateVelocities:function(t,e){for(var i,n=1-this.options.drag,o=null,r=0,s=t.length;s>r;++r)i=(o=t[r]).state,\"static\"===o.treatment||o.sleep()?(i.vel.zero(),i.acc.zero(),i.angular.vel=0,i.angular.acc=0):(n&&i.vel.mult(n),i.old.vel.clone(i.vel),i.vel.vadd(i.old.acc.vadd(i.acc).mult(.5*e)),i.old.acc.clone(i.acc),i.acc.zero(),i.old.angular.vel=i.angular.vel,i.old.angular.acc=i.angular.acc,i.angular.vel+=.5*(i.angular.acc+i.old.angular.acc)*e,i.angular.acc=0,o.started(!0))},integratePositions:function(t,e){for(var i,n=e*e,o=null,r=0,s=t.length;s>r;++r)i=(o=t[r]).state,\"static\"===o.treatment||o.sleep(e)||(o.started()||(i.old.acc.clone(i.acc),i.old.acc.mult(e),i.old.vel.clone(i.vel).vsub(i.old.acc),i.old.acc.mult(1/e)),i.old.pos.clone(i.pos),i.old.vel.mult(e),i.old.acc.mult(.5*n),i.pos.vadd(i.old.vel).vadd(i.old.acc),i.old.vel.mult(1/e),i.old.acc.mult(2/n),o.started()||(i.old.angular.acc=i.angular.acc,i.old.angular.vel=i.angular.vel-i.old.angular.acc*e),i.old.angular.pos=i.angular.pos,i.angular.pos+=i.angular.vel*e+.5*i.old.angular.acc*n)}}})),i.renderer(\"canvas\",(function(t){if(!e)return{};var n=2*Math.PI,o=function(t,i){var n=e.createElement(t||\"div\");return i&&(n.innerHTML=i),n},r=\"#fff\",s=\"#542437\",a=\"#53777A\",l={metaEl:null,styles:{point:a,circle:{strokeStyle:a,lineWidth:1,fillStyle:a,angleIndicator:r},rectangle:{strokeStyle:s,lineWidth:1,fillStyle:s,angleIndicator:r},\"convex-polygon\":{strokeStyle:s,lineWidth:1,fillStyle:s,angleIndicator:r}},offset:{x:0,y:0}};return{init:function(n){var r=this;if(t.init.call(this,n),this.options.defaults(l,!0),this.options.onChange((function(){r.options.offset=new i.vector(r.options.offset)})),this.options(n,!0),this.hiddenCanvas=e.createElement(\"canvas\"),this.hiddenCanvas.width=this.hiddenCanvas.height=100,!this.hiddenCanvas.getContext)throw\"Canvas not supported\";this.hiddenCtx=this.hiddenCanvas.getContext(\"2d\");var s=this.el;if(\"CANVAS\"!==s.nodeName.toUpperCase()&&(s=e.createElement(\"canvas\"),this.el.appendChild(s),\"string\"==typeof this.options.el&&this.el===e.body&&(s.id=this.options.el),this.el=s),this.container=this.el.parentNode,this.ctx=s.getContext(\"2d\"),this.els={},this.options.meta){var a=this.options.metaEl||o();a.className=\"pjs-meta\",this.els.fps=o(\"span\"),this.els.ipf=o(\"span\"),a.appendChild(o(\"span\",\"fps: \")),a.appendChild(this.els.fps),a.appendChild(o(\"br\")),a.appendChild(o(\"span\",\"ipf: \")),a.appendChild(this.els.ipf),s.parentNode.insertBefore(a,s)}this._layers={},this.addLayer(\"main\",this.el),this.options.autoResize?this.resize():this.resize(this.options.width,this.options.height)},layer:function(t){return t in this._layers?this._layers[t]:null},addLayer:function(t,n,o){var r=this,s=[],a=i.util.extend({},this.options.styles),l={id:t,el:n||e.createElement(\"canvas\"),options:i.util.options({width:this.el.width,height:this.el.height,manual:!1,autoResize:!0,follow:null,offset:null,scale:1,zIndex:1})(o)};if(t in this._layers)throw'Layer \"'+t+'\" already added.';return this.el.parentNode.insertBefore(l.el,this.el),l.el.style.position=\"absolute\",l.el.style.zIndex=l.options.zIndex,l.el.className+=\" pjs-layer-\"+l.id,l.ctx=l.el.getContext(\"2d\"),l.ctx.scale(1,1),l.el.width=l.options.width,l.el.height=l.options.height,l.bodies=s,l.reset=function(t){return s=t||[],l},l.addToStack=function(t){return i.util.isArray(t)?s.push.apply(s,t):s.push(t),l},l.removeFromStack=function(t){var e,n;if(i.util.isArray(t))for(e=0,n=t.length;n>e;++e)l.removeFromStack(t[e]);else(e=i.util.indexOf(s,t))>-1&&s.splice(e,1);return l},l.render=function(t){var e,n,o=i.scratchpad(),c=o.vector().set(0,0),h=l.options.scale,u=s.length,d=r._interpolateTime,p=u||\"main\"!==l.id?s:r._world._bodies;if(l.options.manual)return o.done(),l;for(l.options.offset&&(\"center\"===l.options.offset?c.add(.5*l.el.width,.5*l.el.height).mult(1/h):c.vadd(l.options.offset).mult(1/h)),l.options.follow&&(c.vsub(l.options.follow.state.pos),c.sub(l.options.follow.state.vel.get(0)*d,l.options.follow.state.vel.get(1)*d)),!1!==t&&l.ctx.clearRect(0,0,l.el.width,l.el.height),1!==h&&(l.ctx.save(),l.ctx.scale(h,h)),n=0,u=p.length;u>n;++n)(e=p[n]).hidden||(e.view||(e.view=r.createView(e.geometry,e.styles||a[e.geometry.name])),r.drawBody(e,e.view,l.ctx,c));return 1!==h&&l.ctx.restore(),o.done(),l},this._layers[t]=l,l},removeLayer:function(t){var e=t.id?t.id:t,i=this._layers[e].el;return i!==this.el&&i.parentNode.removeChild(i),delete this._layers[e],this},resize:function(e,i){var n;for(var o in t.resize.call(this,e,i),this._layers)(n=this._layers[o]).options.autoResize&&(n.el.width=this.width,n.el.height=this.height);return this},setStyle:function(t,e){e=e||this.ctx,i.util.isObject(t)?(t.strokeStyle=t.lineWidth?t.strokeStyle:\"rgba(0,0,0,0)\",i.util.extend(e,t)):(e.fillStyle=e.strokeStyle=t,e.lineWidth=1)},drawCircle:function(t,e,i,o,r){(r=r||this.ctx).beginPath(),this.setStyle(o,r),r.arc(t,e,i,0,n,!1),r.closePath(),r.stroke(),r.fill()},drawPolygon:function(t,e,i){var n=t[0],o=n.x,r=n.y,s=t.length;(i=i||this.ctx).beginPath(),this.setStyle(e,i),i.moveTo(o,r);for(var a=1;s>a;++a)o=(n=t[a]).x,r=n.y,i.lineTo(o,r);s>2&&i.closePath(),i.stroke(),i.fill()},drawRect:function(t,e,i,n,o,r){var s=.5*i,a=.5*n;r=r||this.ctx,this.setStyle(o,r),r.beginPath(),r.rect(t-s,e-a,i,n),r.closePath(),r.stroke(),r.fill()},drawLine:function(t,e,i,n){var o=t.x,r=t.y;(n=n||this.ctx).beginPath(),this.setStyle(i,n),n.moveTo(o,r),o=e.x,r=e.y,n.lineTo(o,r),n.stroke(),n.fill()},draw:function(t,e,i,n){var o=t.name,r=+(n&&n.x),s=+(n&&n.y),a=t.aabb().hw;if(i=i||this.ctx,e=e||this.options.styles[o]||this.options.styles.circle||{},i.save(),i.translate(r,s),\"circle\"===o)this.drawCircle(0,0,t.radius,e,i);else if(\"convex-polygon\"===o)this.drawPolygon(t.vertices,e,i);else if(\"rectangle\"===o)this.drawRect(0,0,t.width,t.height,e,i);else if(\"compound\"===o)for(var l,c=0,h=t.children.length;h>c;c++)l=t.children[c],i.translate(l.pos.x,l.pos.y),i.rotate(l.angle),this.draw(l.g,e,i),i.rotate(-l.angle),i.translate(-l.pos.x,-l.pos.y);else this.drawCircle(0,0,1,e,i);return\"compound\"!==o&&e.angleIndicator&&(i.beginPath(),this.setStyle(e.angleIndicator,i),i.moveTo(0,0),i.lineTo(a,0),i.closePath(),i.stroke()),i.restore(),this},createView:function(t,e){var i,n=t.aabb(),o=n.hw+Math.abs(n.x),r=n.hh+Math.abs(n.y),s={x:o+1,y:r+1},a=this.hiddenCtx,l=this.hiddenCanvas;return(e=e||this.options.styles[name]||this.options.styles.circle||{}).src?((i=new Image).src=e.src,e.width&&(i.width=e.width),e.height&&(i.height=e.height),i):(s.x+=0|e.lineWidth,s.y+=0|e.lineWidth,l.width=2*o+2+(2*e.lineWidth|0),l.height=2*r+2+(2*e.lineWidth|0),this.draw(t,e,a,s),(i=new Image(l.width,l.height)).src=l.toDataURL(\"image/png\"),i)},drawMeta:function(t){this.els.fps.innerHTML=t.fps.toFixed(2),this.els.ipf.innerHTML=t.ipf},drawBody:function(t,e,i,n){var o,r,s,a=t.state.pos,l=t.offset,c=t.state.vel,h=this._interpolateTime||0;n=n||this.options.offset,i=i||this.ctx,o=a._[0]+n.x+c._[0]*h,r=a._[1]+n.y+c._[1]*h,s=t.state.angular.pos+t.state.angular.vel*h,i.save(),i.translate(o,r),i.rotate(s),i.translate(l._[0],l._[1]),i.drawImage(e,-e.width/2,-e.height/2,e.width,e.height),i.restore()},render:function(t,e){for(var i in this._world.emit(\"beforeRender\",{renderer:this,meta:e}),this.options.meta&&this.drawMeta(e),this._interpolateTime=e.interpolateTime,this._layers)this._layers[i].render();return this}}})),i.renderer(\"dom\",(function(t){if(!e)return{};var i={},n=e.createElement(\"div\"),o=function(t){return t.replace(/(?:^|\\s)\\w/g,(function(t){return t.toUpperCase()}))},r=function(t){if(i[t])return i[t];for(var e,r=[\"Webkit\",\"Moz\",\"Ms\",\"O\"],s=0,a=r.length;a>s;++s)if((e=r[s]+o(t))in n.style)return i[t]=e;return e in n.style&&(i[t]=t)},s=\"pjs-\",a=\"px\",l=r(\"transform\"),c=r(\"borderRadius\"),h=function(t,i){var n=e.createElement(t||\"div\");return i&&(n.innerHTML=i),n};return{init:function(e){t.init.call(this,e);var i=this.el;if(i.style.position=\"relative\",i.style.overflow=\"hidden\",i.style[l]=\"translateZ(0)\",i.style.width=this.options.width+a,i.style.height=this.options.height+a,this.els={},e.meta){var n=h();n.className=\"pjs-meta\",this.els.fps=h(\"span\"),this.els.ipf=h(\"span\"),n.appendChild(h(\"span\",\"fps: \")),n.appendChild(this.els.fps),n.appendChild(h(\"br\")),n.appendChild(h(\"span\",\"ipf: \")),n.appendChild(this.els.ipf),i.appendChild(n)}this.options.autoResize?this.resize():this.resize(this.options.width,this.options.height)},resize:function(e,i){t.resize.call(this,e,i),this.el.style.width=this.width+a,this.el.style.height=this.height+a},pointProperties:function(t){t.style.width=\"2px\",t.style.height=\"2px\",t.style.marginLeft=\"-1px\",t.style.marginTop=\"-1px\",t.style[c]=\"50%\"},circleProperties:function(t,e){var i=e.aabb();t.style.width=2*i.hw+a,t.style.height=2*i.hh+a,t.style.marginLeft=-i.hw+a,t.style.marginTop=-i.hh+a,t.style[c]=\"50%\"},rectangleProperties:function(t,e){var i=e.aabb();t.style.width=2*i.hw+a,t.style.height=2*i.hh+a,t.style.marginLeft=-i.hw+a,t.style.marginTop=-i.hh+a},createView:function(t){var e,i=h(),n=t.name+\"Properties\";if(i.className=s+t.name,i.style.position=\"absolute\",i.style.top=\"0px\",i.style.left=\"0px\",\"compound\"===t.name)for(var o,r=0,a=t.children.length;a>r;r++)o=t.children[r],(e=h()).className=s+t.name+\" \"+s+\"child\",e.style.position=\"absolute\",e.style.top=\"0px\",e.style.left=\"0px\",this[o.g.name+\"Properties\"]&&this[o.g.name+\"Properties\"](e,o.g),e.style[l]=\"translate(\"+o.pos._[0]+\"px,\"+o.pos._[1]+\"px) rotate(\"+o.angle+\"rad)\",i.appendChild(e);else this[n]&&this[n](i,t);return this.el.appendChild(i),i},connect:function(t){t.on(\"add:body\",this.attach,this),t.on(\"remove:body\",this.detach,this)},disconnect:function(t){t.off(\"add:body\",this.attach,this),t.off(\"remove:body\",this.detach,this)},detach:function(t){var e=t.nodeType&&t||t.body&&t.body.view,i=e&&e.parentNode;return e&&i&&i.removeChild(e),this},attach:function(t){var e=t.nodeType&&t||t.body&&t.body.view;return e&&this.el.appendChild(e),this},drawMeta:function(t){this.els.fps.innerHTML=t.fps.toFixed(2),this.els.ipf.innerHTML=t.ipf},drawBody:function(t,e){var i,n,o,r=t.state.pos,s=t.state.vel,a=t.offset,c=this._interpolateTime;i=r._[0]+s._[0]*c,n=r._[1]+s._[1]*c,o=t.state.angular.pos+t.state.angular.vel*c,e.style[l]=\"translate(\"+i+\"px,\"+n+\"px) rotate(\"+o+\"rad) translate(\"+a._[0]+\"px,\"+a._[1]+\"px)\"}}})),i.renderer(\"pixi\",(function(n){if(!e)return{};var o=(Math.PI,{white:\"0xFFFFFF\",violet:\"0x542437\",blue:\"0x53777A\"}),r={font:\"18px monospace\",fill:\"black\",align:\"left\"},s={metaEl:null,offset:{x:0,y:0},styles:{color:!1,point:o.blue,circle:{strokeStyle:o.blue,lineWidth:1,fillStyle:o.blue,angleIndicator:o.white,fillAlpha:1,strokeAlpha:1,alpha:1},rectangle:{strokeStyle:o.violet,lineWidth:1,fillStyle:o.violet,angleIndicator:o.white,fillAlpha:1,strokeAlpha:1,alpha:1},\"convex-polygon\":{strokeStyle:o.violet,lineWidth:1,fillStyle:o.violet,angleIndicator:o.white,fillAlpha:1,strokeAlpha:1,alpha:1}}};return{init:function(o){var r,a,l=this;if(\"undefined\"==typeof PIXI)throw\"PIXI not present - cannot continue\";n.init.call(this,o),this.options.defaults(s,!0),this.options.onChange((function(){l.options.offset=new i.vector(l.options.offset)})),this.options(o,!0),a=!this.options.styles.color||\"transparent\"===this.options.styles.color,this.stage=new PIXI.Stage(this.options.styles.color),this.meta={},r=this.el&&\"CANVAS\"===this.el.nodeName?r:null,this.renderer=new PIXI.autoDetectRenderer(this.options.width,this.options.height,{view:r,transparent:a,resolution:t.devicePixelRatio||1}),r||(this.el=this.el||e.body,this.el.appendChild(this.renderer.view)),this.options.autoResize?this.resize():this.resize(this.options.width,this.options.height)},resize:function(t,e){n.resize.call(this,t,e),this.renderer.resize(this.width,this.height)},connect:function(t){t.on(\"add:body\",this.attach,this),t.on(\"remove:body\",this.detach,this)},disconnect:function(t){t.off(\"add:body\",this.attach,this),t.off(\"remove:body\",this.detach,this)},detach:function(t){var e=t instanceof PIXI.Graphics&&t||t.body&&t.body.view;return e&&this.stage.removeChild(e),this},attach:function(t){var e=t instanceof PIXI.Graphics&&t||t.body&&t.body.view;return e&&this.stage.addChild(e),this},loadSpriteSheets:function(t,e){if(!i.util.isArray(t))throw\"Spritesheets must be defined in arrays\";var n=this,o=new PIXI.AssetLoader(t);return o.load(),o.on(\"onComplete\",(function(){n.assetsLoaded=!0,e()})),n},drawBody:function(t,e){var i,n,o,r=t.state.pos,s=t.state.vel,a=t.offset,l=this._interpolateTime||0;i=r._[0]+s._[0]*l,n=r._[1]+s._[1]*l,o=t.state.angular.pos+t.state.angular.vel*l,e.position.set(i,n),e.pivot.set(-a._[0],-a._[1]),e.rotation=o},render:function(t,e){n.render.call(this,t,e),this.renderer.render(this.stage)},setStyles:function(t,e){return i.util.isObject(e)?(e.fillStyle&&\"transparent\"!==e.fillStyle?(t.beginFill(e.fillStyle),t.fillAlpha=void 0!==e.fillAlpha?e.fillAlpha:1):(t.beginFill(),t.fillAlpha=0),t.lineStyle(e.lineWidth||0,e.strokeStyle,void 0!==e.strokeAlpha?e.strokeAlpha:1),t.alpha=void 0!==e.alpha?e.alpha:1):(e&&\"transparent\"!==e?t.beginFill(e):(t.beginFill(),t.fillAlpha=0),t.lineStyle(0)),t},createCircle:function(t,e,i,n){var o=new PIXI.Graphics;return this.setStyles(o,n),o.drawCircle(t,e,i),o.endFill(),o},createRect:function(t,e,i,n,o){var r=new PIXI.Graphics;return this.setStyles(r,o),r.drawRect(t,e,i,n),r.endFill(),r},createPolygon:function(t,e){var i=t[0],n=i.x,o=i.y,r=t.length,s={x:n,y:o},a=new PIXI.Graphics;this.setStyles(a,e),a.moveTo(n,o);for(var l=1;r>l;++l)n=(i=t[l]).x,o=i.y,a.lineTo(n,o);return r>2&&a.lineTo(s.x,s.y),a.endFill(),a},createLine:function(t,e,i){var n=t.x,o=t.y,r=new PIXI.Graphics;return this.setStyles(r,i),r.moveTo(n,o),n=e.x,o=e.y,r.lineTo(n,o),r.endFill(),r},createView:function(t,e,i){var n=null,o=t.aabb(),r=o.hw+Math.abs(o.x),s=(o.hh,Math.abs(o.y),t.name);if(i=i||this.stage,(e=e||this.options.styles[s]||this.options.styles.circle||{}).src)return(n=PIXI.Sprite.fromImage(e.src)).anchor.set(.5,.5),e.anchor&&(n.anchor.x=e.anchor.x,n.anchor.y=e.anchor.y),e.width&&(n.width=e.width),e.height&&(n.height=e.height),i.addChild(n),n;if(\"circle\"===s)n=this.createCircle(0,0,t.radius,e);else if(\"convex-polygon\"===s)n=this.createPolygon(t.vertices,e);else if(\"rectangle\"===s)n=this.createRect(-t.width/2,-t.height/2,t.width,t.height,e);else if(\"compound\"===s){n=new PIXI.Graphics;for(var a,l,c=0,h=t.children.length;h>c;c++)a=t.children[c],(l=this.createView(a.g,e,n)).position.set(a.pos.x,a.pos.y),l.rotation=a.angle}else n=this.createCircle(0,0,1,e);return\"compound\"!==s&&e.angleIndicator&&\"transparent\"!==e.angleIndicator&&(n.lineStyle(e.lineWidth,e.angleIndicator),n.moveTo(0,0),n.lineTo(r,0)),\"compound\"!==s&&(n.cacheAsBitmap=!0),i.addChild(n),n},drawMeta:function(t){this.meta.loaded?(this.meta.fps.setText(\"FPS: \"+t.fps.toFixed(2)),this.meta.ipf.setText(\"IPF: \"+t.ipf)):(this.meta.fps=new PIXI.Text(\"FPS: \"+t.fps.toFixed(2),r),this.meta.fps.position.x=15,this.meta.fps.position.y=5,this.meta.ipf=new PIXI.Text(\"IPF: \"+t.ipf,r),this.meta.ipf.position.x=15,this.meta.ipf.position.y=30,this.stage.addChild(this.meta.fps),this.stage.addChild(this.meta.ipf),this.meta.loaded=!0)},createDisplay:function(t,e){var i=null,n=null;switch(t){case\"sprite\":return n=PIXI.Texture.fromImage(e.texture),i=new PIXI.Sprite(n),e.anchor&&(i.anchor.x=e.anchor.x,i.anchor.y=e.anchor.y),e.container?e.container.addChild(i):this.stage.addChild(i),i;case\"movieclip\":if(!this.assetsLoaded)throw\"No assets have been loaded. Use loadSpritesheet() first\";for(var o=[],r=0;r<e.frames.length;r++)n=PIXI.Texture.fromFrame(e.frames[r]),o.push(n);return i=new PIXI.MovieClip(o),e.anchor&&(i.anchor.x=e.anchor.x,i.anchor.y=e.anchor.y),e.container?e.container.addChild(i):this.stage.addChild(i),i;default:throw\"Invalid PIXI.DisplayObject passed\"}},centerAnchor:function(t){null!==t&&(t.anchor.x=.5,t.anchor.y=.5)}}})),i}.call(n)},8:function(t,e,i){var n,o=i(7);(()=>{let e,i,r,s,a,l,c,h,u,d,p=!1,f={},v={},m=[],g={},y=0,b=0,_=0,w=0,x={},P={38:\"up\",40:\"down\",37:\"left\",39:\"right\"},A=(t,e)=>isNaN(t)?e:t,C=o.aabb(0,0,window.innerWidth,window.innerHeight),k=o.behavior(\"edge-collision-detection\",{aabb:C,restitution:0,cof:0}),T=function(){this.cache={}};T.prototype.key=(t,e)=>({rect:[t.width,t.height,e].toString(),circle:[t.geometry.radius,e].toString()}[t.gf_type]),T.prototype.attempt=function(t,e){return this.cache[this.key(t,e)]},T.prototype.set=function(t,e){this.cache[t]=e,n.prototype.external_cache(t,e)};let I,B=new T,M={circle:function(t){return o.body(\"circle\",{name:t.classList.contains(\"movable\")?\"movable\":\"\",treatment:t.classList.contains(\"static\")?\"static\":\"dynamic\",x:0|(t.attributes.cx||t.attributes.x||0).value,y:0|(t.attributes.cy||t.attributes.y||0).value,radius:0|(t.attributes.r||0).value,vy:(t.attributes.vy||0).value,vx:(t.attributes.vx||0).value,restitution:A((t.attributes.bounce||0).value,.5),cof:A((t.attributes.friction||0).value,.5),impulse:!t.classList.contains(\"no-impulse\")})},rect:function(t){return o.body(\"rectangle\",{name:t.classList.contains(\"movable\")?\"movable\":\"\",treatment:t.classList.contains(\"static\")?\"static\":\"dynamic\",width:0|(t.attributes.width||0).value,height:0|(t.attributes.height||0).value,x:0|(t.attributes.x||0).value,y:0|(t.attributes.y||0).value,vy:(t.attributes.vy||0).value,vx:(t.attributes.vx||0).value,restitution:A((t.attributes.bounce||0).value,.5),cof:A((t.attributes.friction||0).value,.5),impulse:!t.classList.contains(\"no-impulse\")})},g:function(t){let e=[];for(let i=0;i<t.children.length;i++)e[i]=z(t.children[i]);if(0!=e.length)return o.body(\"compound\",{name:\"movable\"in t.classList?\"movable\":\"\",treatment:t.classList.contains(\"static\")?\"static\":\"dynamic\",x:0|(t.attributes.x||0).value,y:0|(t.attributes.y||0).value,children:e})}},S={rect:(t,e,i)=>function(){l.width=t.width,l.height=t.height,c.drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t.view.src=l.toDataURL(\"image/png\"),B.set(B.key(t,i),t.view.src)},circle:(t,e,i)=>function(){let n=t.geometry.radius;l.width=2*n,l.height=2*n,c.save(),c.arc(n,n,n,0,2*Math.PI,!1),c.clip(),c.drawImage(e,0,0,e.width,e.height,0,0,2*n,2*n),t.view.src=l.toDataURL(\"image/png\"),B.set(B.key(t,i),t.view.src)}},L=function(t,e){return[t,e].sort().join()},j=function(t){return t in P?P[t]:String.fromCharCode(t)},O=function(){let t=document.getElementById(\"viewport\");if(!t)return;let e=window.innerHeight,i=e*(t.width/t.height);t.style.width=i+\"px\",t.style.height=e+\"px\",t.style.left=(window.innerWidth-i)/2+\"px\",p&&n.prototype.boundaries&&(C=o.aabb(0,0,d.width,d.height),k.setAABB(C))},F=function(){e=document.getElementById(\"game\")||{attributes:{}},i=document.getElementById(\"templates\"),r=document.createElement(\"div\"),s=document.createElement(\"div\"),a=document.createElement(\"style\"),l=document.createElement(\"canvas\"),c=l.getContext(\"2d\"),h=e.children,r.id=\"scoreboard\",document.body.appendChild(r);let t=(e.attributes.img||0).value;t&&(t=n.prototype.cache_proxy(t,\"background\"),a.innerHTML=\"#viewport{background-image:url('\"+t+\"');background-size: cover;}\",document.body.appendChild(a)),n.prototype.modal&&(console.log(\"gameframe.js prot?\"),s.id=\"modal\",s.innerHTML='\\n            <div id=\"box\">\\n                <h1 id=\"modal-title\"></h1>\\n                <div id=\"comment\"></div>\\n                <button type=\"button\"\\n                        id=\"button\"\\n                        onclick=\"GameFrame.GameFrame.prototype.init()\"\\n                        class=\"btn btn-primary\">Play game</button>\\n            </div>\\n            <div id=\"backdrop\"></div>\\n        ',document.body.appendChild(s),document.getElementById(\"modal-title\").innerHTML=n.prototype.name,document.getElementById(\"comment\").innerHTML=n.prototype.instructions)},z=function(t){let e=t.nodeName.toLowerCase(),i=M[e];if(null==i)return void console.warn(\"Woops, element \"+e+\" not known.\");let o=i(t),r=(t.attributes.img||0).value;return r&&S[e]&&(o.gf_type=e,n.prototype.image(o,r)),o},E=function(t){let e=z(t);if(e){let i=[];t.id||(t.id=\"generated_\"+b,b+=1),g[\"#\"+t.id]=e,i[i.length]=\"#\"+t.id;for(let n=0;n<t.classList.length;n++){let o=\".\"+t.classList[n];o in g||(g[o]=new Set),g[o].add(e),i[i.length]=o}e.ids=i,u.add(e)}return e},q=function(t){if(x[t]=!0,t in v)for(let e in v[t])v[t][e](g[e],g)};document.addEventListener(\"keydown\",(function(t){let e=j(t.keyCode);q(e)})),document.addEventListener(\"keyup\",(function(t){x[j(t.keyCode)]=!1})),window.addEventListener(\"resize\",O,!0),(n=function(t,e){n.prototype.name=t.name||\"GameFrame Game\",n.prototype.instructions=t.instructions||\"instructions\",n.prototype.boundaries=!(\"boundaries\"in t)||t.boundaries,n.prototype.impulse=!(\"impulse\"in t)||t.impulse,n.prototype.gravity=\"gravity\"in t&&t.gravity,n.prototype.debug=\"debug\"in t&&t.debug,n.prototype.modal=!(\"modal\"in t)||t.modal,n.prototype.external_cache=\"external_cache\"in t?t.external_cache:function(){},n.prototype.cache_proxy=\"cache_proxy\"in t?t.cache_proxy:function(t){return t},n.prototype.set_score=\"set_score\"in t?t.set_score:function(t){localStorage.setItem(\"highscore\",t)},n.prototype.get_score=\"get_score\"in t?t.get_score:function(t){return 0|localStorage.highscore},n.prototype.set_score(n.prototype.get_score()),n.prototype.game=e,F()}).prototype.collision=function(t,e,i){let n=L(t,e);f[n]=i},n.prototype.remove=function(t){u.removeBody(t),delete g[t.ids[0]];for(let e=1;e<t.ids.length;e++)g[t.ids[e]].delete(t)},n.prototype.registerKeys=function(t,e){for(let i in e)i in v||(v[i]={}),v[i][t]=e[i],!I&&Object.values(P).indexOf(i)+1&&\"undefined\"!=typeof nipplejs&&(I=nipplejs.create({zone:document.body,color:\"blue\"}),I.on(\"dir:up plain:up dir:left plain:left dir:down plain:down dir:right plain:right\",(function(t,i){let n=i.direction.angle;Object.values(P).forEach(t=>{e[t]=t==n}),q(n)})))},n.prototype.registerLoops=function(t){m[m.length]=t},n.prototype.template=function(t,e,n){let o=i.querySelector(t).cloneNode(!0);return o.setAttribute(\"x\",0|(e||o.attributes.x)),o.setAttribute(\"y\",0|(n||o.attributes.y)),E(o)},n.prototype.image=function(t,e){let i=t.gf_type;if(!i)return;let o,r=new Image;t.view=new Image,(o=B.attempt(t,e))?t.view.src=o:(r.setAttribute(\"crossOrigin\",\"anonymous\"),r.onload=S[i](t,r,e),r.src=n.prototype.cache_proxy(e,B.key(t,e)))},n.prototype.gameOver=function(){s.classList=\"\",document.getElementById(\"viewport\").remove(),document.getElementById(\"modal-title\").innerHTML=\"Gameover\";let t=document.getElementById(\"comment\");t.innerHTML=\"Score:\"+y,t.innerHTML+=\"<br/> Highscore:\"+n.prototype.get_score(),I&&(I.destroy(),I=void 0),o.util.ticker.stop(),u.destroy()},n.prototype.score=function(t){y+=t||0,y>n.prototype.get_score()&&n.prototype.set_score(y),r.innerHTML=\"Score: \"+y},n.prototype.init=function(){console.log(\"init1\"),s.classList=\"hidden\",n.prototype.debug||(window.scrollTo(0,1),document.body.webkitRequestFullScreen&&document.body.webkitRequestFullScreen()),y=0,_=0,tp=0,f={},v={},m=[],g={},console.log(\"init2\"),o({sleepDisabled:!0},(function(t){u=t,k=o.behavior(\"edge-collision-detection\",{aabb:C,restitution:A((e.attributes.bounce||0).value,.5),cof:A((e.attributes.friction||0).value,.5)});for(let t=0;t<h.length;t++)E(h[t]);d=o.renderer(\"canvas\",{el:\"viewport\",meta:!1,width:1366,height:768,autoResize:!1}),u.add(d),u.on(\"collisions:detected\",(function(t){let e;for(let i=t.collisions.length-1;i>=0;i--)if(e=t.collisions[i],e.bodyA.ids&&e.bodyB.ids)for(let t=0;t<e.bodyA.ids.length;t++)for(let i=0;i<e.bodyB.ids.length;i++){let n=L(e.bodyA.ids[t],e.bodyB.ids[i]);n in f&&(datum={},datum[e.bodyA.ids[t]]=e.bodyA,datum[e.bodyB.ids[i]]=e.bodyB,f[n](datum,g))}})),u.on(\"interact:click\",(function(t){if(\"click\"in v)for(let e in v.click)v.click[e](g[e],g,t)})),u.add([o.behavior(\"body-collision-detection\",{checkAll:!1}),o.behavior(\"sweep-prune\"),o.behavior(\"interactive-custom\",{el:d.el}).applyTo(u.find({name:\"movable\"}))]),n.prototype.boundaries&&u.add(k),n.prototype.impulse&&u.add(o.behavior(\"body-impulse-response\").applyTo(u.find({impulse:!0}))),n.prototype.gravity&&u.add(o.behavior(\"constant-acceleration\")),u.on(\"step\",(function(){let t=_-w;for(let e=0;e<m.length;e++)m[e](g,t);u.render()})),p||o.util.ticker.on((function(t){w=_,_=t,0==w&&(w=_),u.step(t)})),o.util.ticker.start(),p=!0})),n.prototype.score(0),n.prototype.game(this),O()},t.exports.GameFrame=n})(),console.log(\"end gameframe.js\"),console.log(window)}});","extractedComments":[]}